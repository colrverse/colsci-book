<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 Analysing Data | The pavo handbook: studying biological colouration in R</title>
<meta name="generator" content="bookdown 0.39.1 with bs4_book()">
<meta property="og:title" content="Chapter 3 Analysing Data | The pavo handbook: studying biological colouration in R">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 3 Analysing Data | The pavo handbook: studying biological colouration in R">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.7.0/transition.js"></script><script src="libs/bs3compat-0.7.0/tabs.js"></script><script src="libs/bs3compat-0.7.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
<meta name="description" content="Let’s again begin by loading the package. # Load the package, and set a global random-number seed # for the reproducible generation of fake data later on. library(pavo) set.seed(1612217)  3.1...">
<meta property="og:description" content="Let’s again begin by loading the package. # Load the package, and set a global random-number seed # for the reproducible generation of fake data later on. library(pavo) set.seed(1612217)  3.1...">
<meta name="twitter:description" content="Let’s again begin by loading the package. # Load the package, and set a global random-number seed # for the reproducible generation of fake data later on. library(pavo) set.seed(1612217)  3.1...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The pavo handbook: studying biological colouration in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Package Overview</a></li>
<li><a class="" href="importing-processing-and-visualising-data.html"><span class="header-section-number">2</span> Importing, Processing, and Visualising Data</a></li>
<li><a class="active" href="analysing-data.html"><span class="header-section-number">3</span> Analysing Data</a></li>
<li><a class="" href="spectral-shape-descriptors.html"><span class="header-section-number">4</span> Spectral shape descriptors</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/colrverse/colsci-book">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="analysing-data" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Analysing Data<a class="anchor" aria-label="anchor" href="#analysing-data"><i class="fas fa-link"></i></a>
</h1>
<p>Let’s again begin by loading the package.</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the package, and set a global random-number seed</span></span>
<span><span class="co"># for the reproducible generation of fake data later on.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://pavo.colrverse.com">pavo</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1612217</span><span class="op">)</span></span></code></pre></div>
<div id="analysing-spectral-data" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Analysing Spectral Data<a class="anchor" aria-label="anchor" href="#analysing-spectral-data"><i class="fas fa-link"></i></a>
</h2>
<div id="spectral-dataset-description-1" class="section level3" number="3.1.1">
<h3>
<span class="header-section-number">3.1.1</span> Spectral Dataset Description<a class="anchor" aria-label="anchor" href="#spectral-dataset-description-1"><i class="fas fa-link"></i></a>
</h3>
<p>The raw spectral data used in this example are available from the package repository on <a href="https://github.com/rmaia/pavo">github</a>, located <a href="https://github.com/rmaia/pavo/tree/master/data_external/vignette">here</a>. You can download and extract it to follow the vignette exactly. Alternatively, the data are included as an RData file as part of the package installation, and so can be loaded directly (see below).</p>
<p>The data consist of reflectance spectra, obtained using Avantes equipment and software, from seven bird species: Northern Cardinal <em>Cardinalis cardinalis</em>, Wattled Jacana <em>Jacana jacana</em>, Baltimore Oriole <em>Icterus galbula</em>, Peach-fronted Parakeet <em>Aratinga aurea</em>, American Robin <em>Turdus migratorius</em>, and Sayaca Tanager <em>Thraupis sayaca</em>. Several individuals were measured (sample size varies by species), and 3 spectra were collected from each individual. However, the number of individuals measured per species is uneven and the data have additional peculiarities that should emphasize the flexibility <code>pavo</code> offers, as we’ll see below.</p>
<p>In addition, <code>pavo</code> includes three datasets that can be called with the <code>data</code> function. <code>data(teal)</code>, <code>data(sicalis)</code>, and <code>data(flowers)</code> will all be used in this vignette. See the help files for each dataset for more information; via <code><a href="http://pavo.colrverse.com/reference/teal.html">?teal</a></code>, <code><a href="http://pavo.colrverse.com/reference/sicalis.html">?sicalis</a></code>, and <code><a href="http://pavo.colrverse.com/reference/flowers.html">?flowers</a></code>.</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">specs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/specsdata.rds"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"pavo"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mspecs</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/aggspec.html">aggspec</a></span><span class="op">(</span><span class="va">specs</span>, by <span class="op">=</span> <span class="fl">3</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">spp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\\.[0-9].*$"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">mspecs</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">sppspec</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/aggspec.html">aggspec</a></span><span class="op">(</span><span class="va">mspecs</span>, by <span class="op">=</span> <span class="va">spp</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">spec.sm</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/procspec.html">procspec</a></span><span class="op">(</span><span class="va">sppspec</span>, opt <span class="op">=</span> <span class="st">"smooth"</span>, span <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; processing options applied:
#&gt; smoothing spectra with a span of 0.2</code></pre>
</div>
<div id="overview-1" class="section level3" number="3.1.2">
<h3>
<span class="header-section-number">3.1.2</span> Overview<a class="anchor" aria-label="anchor" href="#overview-1"><i class="fas fa-link"></i></a>
</h3>
<p><code>pavo</code> offers two main approaches for spectral data analysis. First, colour variables can be calculated based on the shape of the reflectance spectra. By using special <code>R</code> classes for spectra data frame objects, this can easily be done using the <code>summary</code> function with an <code>rspec</code> object (see below). The function <code><a href="http://pavo.colrverse.com/reference/peakshape.html">peakshape()</a></code> also returns descriptors for individual peaks in spectral curves, as outlined below.</p>
<p>Second, reflectance spectra can be analysed by accounting for the visual system receiving the colour signal, therefore representing reflectance spectra as perceived colours. To that end, we have implemented a suite of visual models and colourspaces including; the receptor-noise limited model of model of <span class="citation">Vorobyev et al. (<a href="references.html#ref-Vorobyev1998">1998</a>)</span>, <span class="citation">Endler (<a href="references.html#ref-Endler1990">1990</a>)</span>’s segment classification method, flexible di- tri- and tetra-chromatic colourspaces, the Hexagon model of <span class="citation">Chittka (<a href="references.html#ref-Chittka1992">1992</a>)</span>, the colour-opponent coding space of <span class="citation">Backhaus (<a href="references.html#ref-Backhaus1991">1991</a>)</span>, CIELAB and CIEXYZ spaces, and the categorical model of <span class="citation">Troje (<a href="references.html#ref-Troje1993">1993</a>)</span>.</p>
</div>
<div id="spectral-shape-analysis" class="section level3" number="3.1.3">
<h3>
<span class="header-section-number">3.1.3</span> Spectral Shape Analysis<a class="anchor" aria-label="anchor" href="#spectral-shape-analysis"><i class="fas fa-link"></i></a>
</h3>
<div id="colourimetric-variables" class="section level4" number="3.1.3.1">
<h4>
<span class="header-section-number">3.1.3.1</span> Colourimetric Variables<a class="anchor" aria-label="anchor" href="#colourimetric-variables"><i class="fas fa-link"></i></a>
</h4>
<p>Obtaining colourimetric variables (pertaining to hue, saturation and brightness/value) is pretty straightforward in <code>pavo</code>. Since reflectance spectra is stored in an object of class <code>rspec</code>, the <code>summary</code> function recognizes the object as such and extracts 23 variables, as outlined in <span class="citation">Montgomerie (<a href="references.html#ref-Montgomerie2006">2006</a>)</span> (and reproduced <a href="spectral-shape-descriptors.html">here</a>). Though outlined in a book chapter on bird colouration, these variables are broadly applicable to any reflectance data, particularly if the taxon of interest has colour vision within the UV-human visible range.</p>
<p>The description and formulas for these variables can be found by running <code><a href="http://pavo.colrverse.com/reference/summary.rspec.html">?summary.rspec</a></code>.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">spec.sm</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;                B1       B2       B3        S1U        S1V
#&gt; cardinal 8984.266 22.40465 52.70167 0.16614848 0.19110215
#&gt; jacana   9668.503 24.11098 53.78744 0.09601072 0.11022142
#&gt; oriole   9108.474 22.71440 54.15508 0.07484472 0.08323604
#&gt; parakeet 6020.733 15.01430 29.86504 0.16792815 0.18501247
#&gt; robin    5741.392 14.31769 37.85542 0.08503645 0.10014331
#&gt; tanager  8515.251 21.23504 30.48108 0.20322408 0.23904955
#&gt;                 S1B       S1G       S1Y       S1R        S2
#&gt; cardinal 0.11783711 0.1898843 0.2519174 0.5333116  7.607769
#&gt; jacana   0.19494363 0.3079239 0.2482692 0.4083129  7.101897
#&gt; oriole   0.05728179 0.3254691 0.3624909 0.5492239 14.507969
#&gt; parakeet 0.14407795 0.4244676 0.3395961 0.2718894  5.111074
#&gt; robin    0.14428130 0.2673730 0.2668138 0.5100635  9.130156
#&gt; tanager  0.26133545 0.3198724 0.2430666 0.2238857  3.226417
#&gt;                 S3         S4       S5       S6         S7       S8
#&gt; cardinal 0.2954315 0.20287401 4003.465 45.77432 -0.2055325 2.043072
#&gt; jacana   0.2471677 0.05315822 3314.024 46.21377 -0.3054756 1.916710
#&gt; oriole   0.2986678 0.08730015 5233.013 50.42230 -0.5847404 2.219838
#&gt; parakeet 0.4483808 0.27397999 1894.018 24.02183  0.6656480 1.599931
#&gt; robin    0.3031501         NA 2532.414 33.70923 -0.1076722 2.354377
#&gt; tanager  0.3343114 0.16775097 1106.471 21.03373 -0.7851970 0.990520
#&gt;                   S9       S10  H1  H2  H3         H4  H5
#&gt; cardinal  0.83791691 0.4144862 700 419 587 0.02130606 581
#&gt; jacana    0.73309578 0.1018889 700 593 529 0.71519543 468
#&gt; oriole    0.92483219 0.1937922 700 382 551 0.41436251 544
#&gt; parakeet  0.58642273 0.4383490 572 618 634 0.97835569 506
#&gt; robin     0.81473611        NA 700  NA 593 0.42040115 631
#&gt; tanager  -0.04551277 0.1661607 557 594 362 1.52666571 518</code></pre>
<p><code>summary</code> also takes an additional argument <code>subset</code> which if changed from the default <code>FALSE</code> to <code>TRUE</code> will return only the most commonly used colourimetrics <span class="citation">(<a href="references.html#ref-Andersson2006">Andersson and Prager 2006</a>)</span>. <code>summary</code> can also take a vector of colour variable names, which can be used to filter the results</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">spec.sm</span>, subset <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;                B2       S8  H1
#&gt; cardinal 22.40465 2.043072 700
#&gt; jacana   24.11098 1.916710 700
#&gt; oriole   22.71440 2.219838 700
#&gt; parakeet 15.01430 1.599931 572
#&gt; robin    14.31769 2.354377 700
#&gt; tanager  21.23504 0.990520 557</code></pre>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract only brightness variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">spec.sm</span>, subset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B1"</span>, <span class="st">"B2"</span>, <span class="st">"B3"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;                B1       B2       B3
#&gt; cardinal 8984.266 22.40465 52.70167
#&gt; jacana   9668.503 24.11098 53.78744
#&gt; oriole   9108.474 22.71440 54.15508
#&gt; parakeet 6020.733 15.01430 29.86504
#&gt; robin    5741.392 14.31769 37.85542
#&gt; tanager  8515.251 21.23504 30.48108</code></pre>
</div>
<div id="peak-shape-descriptors" class="section level4" number="3.1.3.2">
<h4>
<span class="header-section-number">3.1.3.2</span> Peak Shape Descriptors<a class="anchor" aria-label="anchor" href="#peak-shape-descriptors"><i class="fas fa-link"></i></a>
</h4>
<p>Particularly in cases of reflectance spectra that have multiple discrete peaks (in which case the <code>summary</code> function will only return variables based on the tallest peak in the curve), it might be useful to obtain variables that describe individual peak’s properties. The <code><a href="http://pavo.colrverse.com/reference/peakshape.html">peakshape()</a></code> function identifies the peak location (<code>H1</code>), returns the reflectance at that point (<code>B3</code>), and identifies the wavelengths at which the reflectance is half that at the peak, calculating the wavelength bandwidth of that interval (the Full Width at Half Maximum, or <code>FWHM</code>). The function also returns the half widths, which are useful when the peaks are located near the edge of the measurement limit and half maximum reflectance can only be reliably estimated from one of its sides.</p>
<p>If this all sounds too esoteric, fear not: <code><a href="http://pavo.colrverse.com/reference/peakshape.html">peakshape()</a></code> has the option of returning plots indicating what it’s calculating. The vertical continuous red line indicates the peak location, the horizontal continuous red line indicates the half-maximum reflectance, and the distance between the dashed lines (<code>HWHM.l</code> and <code>HWHM.r</code>) is the FWHM:</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="http://pavo.colrverse.com/reference/peakshape.html">peakshape</a></span><span class="op">(</span><span class="va">spec.sm</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;         id       B3  H1 FWHM HWHM.l HWHM.r incl.min
#&gt; 1 cardinal 52.70167 700   NA    114     NA      Yes
#&gt; 2   jacana 53.78744 700   NA    172     NA      Yes
#&gt; 3   oriole 54.15508 700   NA    149     NA      Yes
#&gt; 4 parakeet 29.86504 572  126     63     63      Yes
#&gt; 5    robin 37.85542 700   NA    107     NA      Yes
#&gt; 6  tanager 30.48108 557  166     81     85      Yes</code></pre>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-48"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-48-1.png" alt="Plots from `peakshape`" width="30%"><img src="colsci-book_files/figure-html/unnamed-chunk-48-2.png" alt="Plots from `peakshape`" width="30%"><img src="colsci-book_files/figure-html/unnamed-chunk-48-3.png" alt="Plots from `peakshape`" width="30%"><img src="colsci-book_files/figure-html/unnamed-chunk-48-4.png" alt="Plots from `peakshape`" width="30%"><img src="colsci-book_files/figure-html/unnamed-chunk-48-5.png" alt="Plots from `peakshape`" width="30%"><img src="colsci-book_files/figure-html/unnamed-chunk-48-6.png" alt="Plots from `peakshape`" width="30%"><p class="caption">
Figure 3.1: Plots from <code>peakshape</code>
</p>
</div>
<p>As it can be seen, the variable FWHM is meaningless if the curve doesn’t have a clear peak. Sometimes, such as in the case of the Cardinal (Above figure, first panel), there might be a peak which is not the point of maximum reflectance of the entire spectral curve. <code><a href="http://pavo.colrverse.com/reference/peakshape.html">peakshape()</a></code> also offers a <code>select</code> argument to facilitate subsetting the spectra data frame to, for example, focus on a single reflectance peak:</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="http://pavo.colrverse.com/reference/peakshape.html">peakshape</a></span><span class="op">(</span><span class="va">spec.sm</span>, select <span class="op">=</span> <span class="fl">2</span>, lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">500</span><span class="op">)</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-49"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-49-1.png" alt="Plot from `peakshape`, setting the wavelength limits to 300 and 500 nm" width="480"><p class="caption">
Figure 3.2: Plot from <code>peakshape</code>, setting the wavelength limits to 300 and 500 nm
</p>
</div>
<pre><code>#&gt;         id       B3  H1 FWHM HWHM.l HWHM.r incl.min
#&gt; 1 cardinal 17.84381 369  100     46     54      Yes</code></pre>
</div>
</div>
<div id="visual-modelling" class="section level3" number="3.1.4">
<h3>
<span class="header-section-number">3.1.4</span> Visual Modelling<a class="anchor" aria-label="anchor" href="#visual-modelling"><i class="fas fa-link"></i></a>
</h3>
<div id="overview-2" class="section level4" number="3.1.4.1">
<h4>
<span class="header-section-number">3.1.4.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview-2"><i class="fas fa-link"></i></a>
</h4>
<p>All visual and colourspace modelling and plotting options are wrapped into four main function: <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code>, <code><a href="http://pavo.colrverse.com/reference/colspace.html">colspace()</a></code>, <code><a href="http://pavo.colrverse.com/reference/coldist.html">coldist()</a></code> (or its bootstrap-based variant <code><a href="http://pavo.colrverse.com/reference/bootcoldist.html">bootcoldist()</a></code>), and <code>plot</code>. As detailed below, these functions cover the basic processes common to most modelling approaches. Namely, the estimation of quantum catches, their conversion to an appropriate space, estimating the distances between samples, and visualising the results. As a brief example, a typical workflow for modelling might use:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code> to estimate photoreceptor quantum catches. The assumptions of visual models may differ dramatically, so be sure to select options that are appropriate for your intended use.</li>
<li>
<code><a href="http://pavo.colrverse.com/reference/colspace.html">colspace()</a></code> to convert the results of <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code> (or user-provided quantum catches) into points in a given colourspace, specified with the <code>space</code> argument. If no <code>space</code> argument is provided, <code><a href="http://pavo.colrverse.com/reference/colspace.html">colspace()</a></code> will automatically select the di-, tri- or tetrahedral colourspace, depending on the nature of the input data. The result of <code><a href="http://pavo.colrverse.com/reference/colspace.html">colspace()</a></code> will be an object of class <code>colspace</code> (that inherits from <code>data.frame</code>), and will contain the location of stimuli in the selected space along with any associated colour variables.</li>
<li>
<code><a href="http://pavo.colrverse.com/reference/coldist.html">coldist()</a></code> or <code><a href="http://pavo.colrverse.com/reference/bootcoldist.html">bootcoldist()</a></code> to estimate the colour distances between points in a colourspace (if the input is from <code>colspace</code>), or the ‘perceptual’, noise-weighted distances in the receptor-noise limited model (if the input is from <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code> where <code>relative = FALSE</code>).</li>
<li>
<code>plot</code> the output. <code>plot</code> will automatically select the appropriate visualisation based on the input <code>colspace</code> object, and will also accept various graphical parameters depending on the colourspace (see <code><a href="http://pavo.colrverse.com/reference/plot.colspace.html">?plot.colspace</a></code> and links therein for details).</li>
</ol>
</div>
<div id="accessing-and-plotting-in-built-spectral-data" class="section level4" number="3.1.4.2">
<h4>
<span class="header-section-number">3.1.4.2</span> Accessing and Plotting In-built Spectral Data<a class="anchor" aria-label="anchor" href="#accessing-and-plotting-in-built-spectral-data"><i class="fas fa-link"></i></a>
</h4>
<p>All in-built spectral data in <code>pavo</code> can be easily retrieved and/or plotted via the <code><a href="http://pavo.colrverse.com/reference/sensdata.html">sensdata()</a></code> function. These data can be visualised directly by including <code>plot = TRUE</code>, or assigned to an object for subsequent use, as in:</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">musca_sense</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/sensdata.html">sensdata</a></span><span class="op">(</span>visual <span class="op">=</span> <span class="st">"musca"</span>, achromatic <span class="op">=</span> <span class="st">"md.r1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">musca_sense</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;    wl    musca.u     musca.s     musca.m     musca.l       md.r1
#&gt; 1 300 0.01148992 0.006726680 0.001533875 0.001524705 0.001713692
#&gt; 2 301 0.01152860 0.006749516 0.001535080 0.001534918 0.001731120
#&gt; 3 302 0.01156790 0.006773283 0.001536451 0.001545578 0.001751792
#&gt; 4 303 0.01160839 0.006798036 0.001537982 0.001556695 0.001775960
#&gt; 5 304 0.01165060 0.006823827 0.001539667 0.001568283 0.001803871
#&gt; 6 305 0.01169510 0.006850712 0.001541499 0.001580352 0.001835777</code></pre>
</div>
<div id="visual-phenotypes" class="section level4" number="3.1.4.3">
<h4>
<span class="header-section-number">3.1.4.3</span> Visual Phenotypes<a class="anchor" aria-label="anchor" href="#visual-phenotypes"><i class="fas fa-link"></i></a>
</h4>
<p><code>pavo</code> contains numerous di-, tri- and tetrachromatic visual systems, to accompany the suite of new models. The full complement of included systems are accessible via the <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code> argument <code>visual</code>, and include:</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-51">Table 3.1: </span>Built-in visual phenotypes available in pavo</caption>
<colgroup>
<col width="10%">
<col width="89%">
</colgroup>
<thead><tr class="header">
<th align="left">phenotype</th>
<th align="left">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">avg.uv</td>
<td align="left">average ultraviolet-sensitive avian (tetrachromat)</td>
</tr>
<tr class="even">
<td align="left">avg.v</td>
<td align="left">average violet-sensitive avian (tetrachromat)</td>
</tr>
<tr class="odd">
<td align="left">bluetit</td>
<td align="left">The blue tit <em>Cyanistes caeruleus</em> (tetrachromat)</td>
</tr>
<tr class="even">
<td align="left">star</td>
<td align="left">The starling <em>Sturnus vulgaris</em> (tetrachromat)</td>
</tr>
<tr class="odd">
<td align="left">pfowl</td>
<td align="left">The peafowl <em>Pavo cristatus</em> (tetrachromat)</td>
</tr>
<tr class="even">
<td align="left">apis</td>
<td align="left">The honeybee <em>Apis mellifera</em> (trichromat)</td>
</tr>
<tr class="odd">
<td align="left">ctenophorus</td>
<td align="left">The ornate dragon lizard <em>Ctenophorus ornatus</em> (trichromat)</td>
</tr>
<tr class="even">
<td align="left">canis</td>
<td align="left">The canid <em>Canis familiaris</em> (dichromat)</td>
</tr>
<tr class="odd">
<td align="left">musca</td>
<td align="left">The housefly <em>Musca domestica</em> (tetrachromat)</td>
</tr>
<tr class="even">
<td align="left">cie2</td>
<td align="left">2-degree colour matching functions for CIE models of human colour vision (trichromat)</td>
</tr>
<tr class="odd">
<td align="left">cie10</td>
<td align="left">10-degree colour matching functions for CIE models of human colour vision (trichromat)</td>
</tr>
<tr class="even">
<td align="left">segment</td>
<td align="left">A generic ‘viewer’ with broad sensitivities for use in the segment analysis of Endler (1990) (tetrachromat)</td>
</tr>
<tr class="odd">
<td align="left">habronattus</td>
<td align="left">The jumping spider <em>Habronattus pyrrithrix</em> (trichromat)</td>
</tr>
<tr class="even">
<td align="left">rhinecanthus</td>
<td align="left">The triggerfish <em>Rhinecanthus aculeatus</em> (trichromat)</td>
</tr>
<tr class="odd">
<td align="left">drosophila</td>
<td align="left">The vinegar fly <em>Drosophila melanogaster</em>
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="estimating-quantum-catch" class="section level4" number="3.1.4.4">
<h4>
<span class="header-section-number">3.1.4.4</span> Estimating Quantum Catch<a class="anchor" aria-label="anchor" href="#estimating-quantum-catch"><i class="fas fa-link"></i></a>
</h4>
<p>Numerous models have been developed to understand how colours are perceived and discriminated by an individual’s or species’ visual system <span class="citation">(described in detail in <a href="references.html#ref-Endler1990">Endler 1990</a>; <a href="references.html#ref-Renoult2017">Renoult, Kelber, and Schaefer 2017</a>; <a href="references.html#ref-Vorobyev1998">Vorobyev et al. 1998</a>)</span>. In essence, these models take into account the receptor sensitivity of the different receptors that make the visual system in question and quantify how a given colour would stimulate those receptors individually, and their combined effect on the perception of colour. These models also have an important component of assuming and interpreting the chromatic component of colour (hue and saturation) to be processed independently of the achromatic (brightness, or luminance) component. This provides a flexible framework allowing for a tiered model construction, in which information on aspects such as different illumination sources, backgrounds, and visual systems can be considered and compared.</p>
<p>To apply any such model, we first need to quantify receptor excitation and then consider how the signal is being processed, while possibly considering the relative density of different cones and the noise-to-signal ratio.</p>
<p>To quantify the stimulation of receptors by a given stimulus, we will use the function <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code>. This takes an <code>rspec</code> dataframe as a minimal input, and the user can either select from the available options or input their own data for the additional arguments in the function:</p>
<ul>
<li>
<code>visual</code>: the visual system to be used. Available inbuilt options are detailed above, or the user may include their own dataframe, with the first column being the wavelength range and the following columns being the absorbance at each wavelength for each cone type (see below for an example).</li>
<li>
<code>achromatic</code>: Either a receptor’s sensitivity data (available options include the blue tit, chicken, and starling double-cones, and the housefly’s R1-6 receptor), which can also be user-defined as above; or the longest-wavelength receptor, the sum of the two longest-wavelength receptors, or the sum of all receptors can be used. Alternatively, <code>none</code> can be specified for no achromatic stimulation calculation.</li>
<li>
<code>illum</code>: The illuminant being considered. By default, it considers an ideal white illuminant, but implemented options are a blue sky, standard daylight, and forest shade illuminants. A vector of same length as the wavelength range being considered can also be used as the input.</li>
<li>
<code>trans</code>: Models of the effects of light transmission (e.g. through noisy environments or ocular filters). The argument defaults to <code>ideal</code> (i.e. no effect), though users can also use the built-in options of <code>bluetit</code> or <code>blackbird</code> to model the ocular transmission of blue tits/blackbirds, or specify a user-defined vector containing transmission spectra.</li>
<li>
<code>qcatch</code>: This argument determines what photon catch data should be returned
<ul>
<li>
<code>Qi</code>: The receptor quantum catches, calculated for receptor <span class="math inline">\(i\)</span> as:
<span class="math display">\[Q_i = \int_\lambda{R_i(\lambda)S(\lambda)I(\lambda)d\lambda}\]</span>
Where <span class="math inline">\(\lambda\)</span> denotes the wavelength, <span class="math inline">\(R_i(\lambda)\)</span> the spectral sensitivity of receptor <span class="math inline">\(i\)</span>, <span class="math inline">\(S(\lambda)\)</span> the reflectance spectrum of the colour, and <span class="math inline">\(I(\lambda)\)</span> the illuminant spectrum.</li>
<li>
<code>fi</code>: The receptor quantum catches transformed according to Fechner’s law, in which the signal of the receptor is proportional to the logarithm of the quantum catch i.e. <span class="math inline">\(f_i = \ln(Q_i)\)</span>
</li>
<li>
<code>Ei</code>: the hyperbolic transform (a simplification of the Michaelis–Menten photoreceptor equation), where <span class="math display">\[E_i = \frac{Q_i}{Q_i + 1}\]</span>.</li>
</ul>
</li>
<li>
<code>bkg</code>: The background being considered. By default, it considers an idealized background (i.e. wavelength-independent influence of the background on colour). A vector of same length as the wavelength range being considered can also be used as the input.</li>
<li>
<code>vonkries</code>: a logical argument which determines if the von Kries transformation (which normalizes receptor quantum catches to the background, thus accounting for receptor adaptation) is to be applied (defaults to <code>FALSE</code>). If <code>TRUE</code>, <span class="math inline">\(Q_i\)</span> is multiplied by a constant <span class="math inline">\(k\)</span>, which describes the von Kries transformation: <span class="math display">\[k_i = \frac{1}{\int_\lambda R_i(\lambda)S^b(\lambda)I(\lambda)d\lambda}\]</span> Where <span class="math inline">\(S^b\)</span> denotes the reflectance spectra of the background.</li>
<li>
<code>scale</code>: This argument defines how the illuminant should be scaled. The scale of the illuminant is critical for receptor noise models in which the signal intensity influences the noise (see Receptor noise section, below). Illuminant curves should be in units of <span class="math inline">\(\mu mol.s^{-1}.m^{-2}\)</span> in order to yield physiologically meaningful results. (Some software return illuminant information values in <span class="math inline">\(\mu Watt.cm^{-2}\)</span>, and must be converted to <span class="math inline">\(\mu mol.s^{-1}.m^{-2}\)</span>. This can be done by using the <code><a href="http://pavo.colrverse.com/reference/irrad2flux.html">irrad2flux()</a></code> and <code><a href="http://pavo.colrverse.com/reference/irrad2flux.html">flux2irrad()</a></code> functions.) Therefore, if the user-specified illuminant curves are <em>not</em> in these units (i.e. are measured proportional to a white standard, for example), the <code>scale</code> parameter can be used as a multiplier to yield curves that are at least a reasonable approximation of the illuminant value. Commonly used values are <strong>500</strong> for dim conditions and <strong>10,000</strong> for bright conditions.</li>
<li>
<code>relative</code>: If <code>TRUE</code>, it will make the cone stimulations relative to their sum. This is appropriate for general colourspace models<span class="citation">(e.g. <a href="references.html#ref-Goldsmith1990">Goldsmith 1990</a>; <a href="references.html#ref-Stoddard2008">Stoddard and Prum 2008</a>)</span>. For the receptor-noise model, however, it is important to set <code>relative = FALSE</code>.</li>
</ul>
<p>All visual models begin with the estimation of receptor quantum catches. The requirements of models may differ significantly of course, so be sure to consult the function documentation and original publications. For this example, we will use the average reflectance of the different species to calculate the raw stimulation of retinal cones, considering the avian average UV visual system, a standard daylight illumination, and an idealized background.</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vismod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">sppspec</span>,</span>
<span>  visual <span class="op">=</span> <span class="st">"avg.uv"</span>, achromatic <span class="op">=</span> <span class="st">"bt.dc"</span>,</span>
<span>  illum <span class="op">=</span> <span class="st">"D65"</span>, relative <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Since there are multiple parameters that can be used to customize the output of <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code>, as detailed above, for convenience these can be returned by using <code>summary</code> in a <code>vismodel</code> object:</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">vismod1</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; visual model options:
#&gt;  * Quantal catch: Qi 
#&gt;  * Visual system, chromatic: avg.uv 
#&gt;  * Visual system, achromatic: bt.dc 
#&gt;  * Illuminant: D65, scale = 1 (von Kries colour correction not applied) 
#&gt;  * Background: ideal 
#&gt;  * Transmission: ideal 
#&gt;  * Relative: FALSE</code></pre>
<pre><code>#&gt;        u                 s                 m         
#&gt;  Min.   :0.01671   Min.   :0.04199   Min.   :0.1325  
#&gt;  1st Qu.:0.02408   1st Qu.:0.06860   1st Qu.:0.1753  
#&gt;  Median :0.03039   Median :0.07148   Median :0.2675  
#&gt;  Mean   :0.03599   Mean   :0.09924   Mean   :0.2338  
#&gt;  3rd Qu.:0.04731   3rd Qu.:0.14265   3rd Qu.:0.2819  
#&gt;  Max.   :0.06353   Max.   :0.17648   Max.   :0.3037  
#&gt;        l               lum        
#&gt;  Min.   :0.2092   Min.   :0.1513  
#&gt;  1st Qu.:0.2232   1st Qu.:0.1966  
#&gt;  Median :0.2759   Median :0.2247  
#&gt;  Mean   :0.3076   Mean   :0.2241  
#&gt;  3rd Qu.:0.3815   3rd Qu.:0.2661  
#&gt;  Max.   :0.4625   Max.   :0.2766</code></pre>
<p>We can visualise what <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code> is doing when estimating quantum catches by comparing the reflectance spectra to the estimates they are generating:</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>no.readonly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span>, oma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">7</span>, <span class="fl">10</span>, <span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">11</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">7</span>, <span class="fl">9</span>, <span class="fl">9</span>, <span class="fl">11</span>, <span class="fl">11</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sppspecol</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/spec2rgb.html">spec2rgb</a></span><span class="op">(</span><span class="va">sppspec</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sppspec</span>,</span>
<span>    select <span class="op">=</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    col <span class="op">=</span> <span class="va">sppspecol</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4.1</span>, <span class="fl">2.5</span>, <span class="fl">2.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">vismod1</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    yaxt <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"Wavelength (nm)"</span>, side <span class="op">=</span> <span class="fl">1</span>, outer <span class="op">=</span> <span class="cn">TRUE</span>, line <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"Reflectance (%)"</span>, side <span class="op">=</span> <span class="fl">2</span>, outer <span class="op">=</span> <span class="cn">TRUE</span>, line <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-54"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-54-1.png" alt="Plots of species mean reflectance curves with corresponding relative usml cone stimulations (insets)." width="100%"><p class="caption">
Figure 3.3: Plots of species mean reflectance curves with corresponding relative usml cone stimulations (insets).
</p>
</div>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span></span></code></pre></div>
<p>As described above, <code>vismodel</code> also accepts user-defined visual systems, background and illuminants. We will illustrate this by showcasing the function <code>sensmodel</code>, which models spectral sensitivities of retinas based on their peak cone sensitivity, as described in <span class="citation">Govardovskii et al. (<a href="references.html#ref-Govardovskii2000">2000</a>)</span> and <span class="citation">Hart and Vorobyev (<a href="references.html#ref-Hart2005">2005</a>)</span>. <code>sensmodel</code> takes several optional arguments, but the main one is a vector containing the peak sensitivities for the cones being modelled. Let’s model an idealized dichromat visual system, with cones peaking in sensitivity at 350 and 650 nm:</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ideal_dichromat</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/sensmodel.html">sensmodel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">350</span>, <span class="fl">650</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ideal_dichromat</span>, ylab <span class="op">=</span> <span class="st">"Absorbance"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-55"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-55-1.png" alt="The receptor sensitivities of an idealised dichromat created using `sensmodel()`." width="480"><p class="caption">
Figure 3.4: The receptor sensitivities of an idealised dichromat created using <code><a href="http://pavo.colrverse.com/reference/sensmodel.html">sensmodel()</a></code>.
</p>
</div>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vismod.idi</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">sppspec</span>,</span>
<span>  visual <span class="op">=</span> <span class="va">ideal_dichromat</span>,</span>
<span>  relative <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">vismod.idi</span></span></code></pre></div>
<pre><code>#&gt;             lmax350   lmax650 lum
#&gt; cardinal 0.14578161 0.3519237  NA
#&gt; jacana   0.09155090 0.3179246  NA
#&gt; oriole   0.06981615 0.3775647  NA
#&gt; parakeet 0.10579320 0.1727374  NA
#&gt; robin    0.04727061 0.2174901  NA
#&gt; tanager  0.16438304 0.2148739  NA</code></pre>
</div>
<div id="the-receptor-noise-model" class="section level4" number="3.1.4.5">
<h4>
<span class="header-section-number">3.1.4.5</span> The Receptor Noise Model<a class="anchor" aria-label="anchor" href="#the-receptor-noise-model"><i class="fas fa-link"></i></a>
</h4>
<p>The receptor-noise limited (RNL) model of <span class="citation">Vorobyev et al. (<a href="references.html#ref-Vorobyev1998">1998</a>)</span>, <span class="citation">Vorobyev et al. (<a href="references.html#ref-Vorobyev2001">2001</a>)</span> offers a basis for estimating the ‘perceptual’ distance between coloured stimuli (depending on available physiological and behavioural data), and assumes that the simultaneous discrimination of colours is fundamentally limited by photoreceptor noise. Colour distances under the RNL model can be calculated by using the inverse of the noise-to-signal ratio, known as the Weber fraction (<span class="math inline">\(w_i\)</span> for each cone <span class="math inline">\(i\)</span>). The Weber fraction can be calculated from the noise-to-signal ratio of cone <span class="math inline">\(i\)</span> (<span class="math inline">\(v_i\)</span>) and the relative number of receptor cells of type <span class="math inline">\(i\)</span> within the receptor field (<span class="math inline">\(n_i\)</span>):</p>
<p><span class="math display">\[w_i = \frac{v_i}{\sqrt{n_i}}\]</span></p>
<p><span class="math inline">\(w_i\)</span> is the value used for the noise when considering only neural noise mechanisms. Alternatively, the model can consider that the intensity of the colour signal itself contributes to the noise (photoreceptor, or quantum, noise). In this case, the noise for a receptor <span class="math inline">\(i\)</span> is calculated as:</p>
<p><span class="math display">\[w_i = \sqrt{\frac{v_i^2}{\sqrt{n_i}} + \frac{2}{Q_a+Q_b}}\]</span></p>
<p>where <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> refer to the two colour signals being compared. Note that when the values of <span class="math inline">\(Q_a\)</span> and <span class="math inline">\(Q_b\)</span> are very high, the second portion of the equation tends to zero, and the both formulas should yield similar results. Hence, it is important that the quantum catch are calculated in the appropriate illuminant scale, as described above.</p>
<p>Colour distances are obtained by weighting the Euclidean distance of the photoreceptor quantum catches by the Weber fraction of the cones (<span class="math inline">\(\Delta S\)</span>). The units of these measures are noise-weighted Euclidean distances measurements, and are often referred to as <span class="math inline">\(\Delta S\)</span> for chromatic distances, and <span class="math inline">\(\Delta L\)</span> for achromatic, or luminance, distances. The relevant calculations are:</p>
<p>For dichromats:
<span class="math display">\[\Delta S = \sqrt{\frac{(\Delta f_1 - \Delta f_2)^2}{w_1^2+w_2^2}}\]</span></p>
<p>For trichromats:
<span class="math display">\[\Delta S = \sqrt{\frac{w_1^2(\Delta f_3 - \Delta f_2)^2 + w_2^2(\Delta f_3 - \Delta f_1)^2 +
w_3^2(\Delta f_1 - \Delta f_2)^2 }{ (w_1w_2)^2 + (w_1w_3)^2 + (w_2w_3)^2 }}\]</span></p>
<p>For tetrachromats:
<span class="math display">\[\Delta S =
\sqrt{(w_1w_2)^2(\Delta f_4 - \Delta f_3)^2 + (w_1w_3)^2(\Delta f_4 - \Delta f_2)^2 +
(w_1w_4)^2(\Delta f_3 - \Delta f_2)^2 + \\ (w_2w_3)^2(\Delta f_4 - \Delta f_1)^2 +
(w_2w_4)^2(\Delta f_3 - \Delta f_1)^2 + (w_3w_4)^2(\Delta f_2 - \Delta f_1)^2 / \\
((w_1w_2w_3)^2 + (w_1w_2w_4)^2 + (w_1w_3w_4)^2 + (w_2w_3w_4)^2)}\]</span></p>
<p>For the chromatic contrast. The achromatic contrast (<span class="math inline">\(\Delta L\)</span>) can be calculated based on the double cone or the receptor (or combination of receptors) responsible for chromatic processing by the equation:</p>
<p><span class="math display">\[\Delta L = \frac{\Delta f}{w}\]</span></p>
<div id="a-brief-note-on-terminology-and-just-noticeable-differences-jnds" class="section level5" number="3.1.4.5.1">
<h5>
<span class="header-section-number">3.1.4.5.1</span> A Brief Note on Terminology and ‘Just Noticeable Differences’ (JNDs)<a class="anchor" aria-label="anchor" href="#a-brief-note-on-terminology-and-just-noticeable-differences-jnds"><i class="fas fa-link"></i></a>
</h5>
<p>The receptor-noise limited model is often closely associated with the concept of ‘just noticeable differences’ (JNDs), to the point where JNDs are presented as the unit of distance or measurement between stimuli in this model/space. The JND is not unique to the receptor-noise limited model, however, nor is it accurately described as a unit of measurement. A JND is simply a contrast threshold which correlates with some discrimination criteria, such as 80% correct choices in a simultaneous-discrimination test, and empirical work continues to show that this correlation is often species-, sex-, individual-, condition-, and/or stimulus-specific. We are therefore supportive of the move in the literature toward divorcing the concept of JND’s from the receptor-noise model specifically and prefer the more accurate description of distances in receptor-noise space as ‘noise-weighted Euclidean distances’, abbreviated to <span class="math inline">\(\Delta S\)</span> (for chromatic distances) and <span class="math inline">\(\Delta L\)</span> (for achromatic distances). Specific noise-weighted Euclidean distances such as <span class="math inline">\(\Delta S = 1\)</span> will indeed correlate with a threshold of discrimination, or a ‘just-noticeable difference’. The circumstances under which this holds (species, sex, viewing conditions, region of colourspace the stimulus occupies etc.) require behavioural validation, however, and the empirically estimated threshold under a given set of circumstances is unlikely to hold firm in the face of gross variation in such conditions.</p>
</div>
<div id="noise-weighted-distances-with-coldist-and-bootcoldist" class="section level5" number="3.1.4.5.2">
<h5>
<span class="header-section-number">3.1.4.5.2</span> Noise-weighted Distances with <code>coldist()</code> and <code>bootcoldist()</code><a class="anchor" aria-label="anchor" href="#noise-weighted-distances-with-coldist-and-bootcoldist"><i class="fas fa-link"></i></a>
</h5>
<p><code>pavo</code> implements the noise-weighted colour distance calculations in the functions <code><a href="http://pavo.colrverse.com/reference/coldist.html">coldist()</a></code> and <code><a href="http://pavo.colrverse.com/reference/bootcoldist.html">bootcoldist()</a></code>, assuming that raw receptor quantum catches are provided (via <code>relative = FALSE</code> in <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code>). For the achromatic contrast, <code><a href="http://pavo.colrverse.com/reference/coldist.html">coldist()</a></code> uses <code>n4</code> to calculate <span class="math inline">\(w\)</span> for the achromatic contrast. Note that even if <span class="math inline">\(Q_i\)</span> is chosen, values are still log-transformed. This option is available in case the user wants to specify a data frame of quantum catches that was not generated by <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code> as an input. In this case, the argument <code>qcatch</code> should be used to inform the function if <span class="math inline">\(Q_i\)</span> or <span class="math inline">\(f_i\)</span> values are being used (note that if the input to <code><a href="http://pavo.colrverse.com/reference/coldist.html">coldist()</a></code> is an object generated using the <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code> function, this argument is ignored.) The type of noise to be calculated can be selected from the <code><a href="http://pavo.colrverse.com/reference/coldist.html">coldist()</a></code> argument <code>noise</code> (which accepts either <code>"neural"</code> or <code>"quantum"</code>).</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="http://pavo.colrverse.com/reference/coldist.html">coldist</a></span><span class="op">(</span><span class="va">vismod1</span>,</span>
<span>  noise <span class="op">=</span> <span class="st">"neural"</span>, achromatic <span class="op">=</span> <span class="cn">TRUE</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  weber <span class="op">=</span> <span class="fl">0.1</span>, weber.achro <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;      patch1   patch2        dS        dL
#&gt; 1  cardinal   jacana  8.436191 3.6082787
#&gt; 2  cardinal   oriole  7.874540 3.5245174
#&gt; 3  cardinal parakeet  8.010167 0.7553289
#&gt; 4  cardinal    robin  5.865464 2.4275512
#&gt; 5  cardinal  tanager 10.116173 2.2442493
#&gt; 6    jacana   oriole 10.114671 0.0837613
#&gt; 7    jacana parakeet  4.316712 2.8529498
#&gt; 8    jacana    robin  3.499380 6.0358299
#&gt; 9    jacana  tanager  5.064380 1.3640294
#&gt; 10   oriole parakeet  8.147778 2.7691885
#&gt; 11   oriole    robin  7.200079 5.9520686
#&gt; 12   oriole  tanager 13.532690 1.2802681
#&gt; 13 parakeet    robin  4.744364 3.1828801
#&gt; 14 parakeet  tanager  5.886396 1.4889204
#&gt; 15    robin  tanager  7.679779 4.6718005</code></pre>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="http://pavo.colrverse.com/reference/coldist.html">coldist</a></span><span class="op">(</span><span class="va">vismod.idi</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, weber <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;      patch1   patch2        dS dL
#&gt; 1  cardinal   jacana 2.0993283 NA
#&gt; 2  cardinal   oriole 4.6567462 NA
#&gt; 3  cardinal parakeet 2.2575457 NA
#&gt; 4  cardinal    robin 3.7236780 NA
#&gt; 5  cardinal  tanager 3.5417700 NA
#&gt; 6    jacana   oriole 2.5574178 NA
#&gt; 7    jacana parakeet 4.3568740 NA
#&gt; 8    jacana    robin 1.6243496 NA
#&gt; 9    jacana  tanager 5.6410983 NA
#&gt; 10   oriole parakeet 6.9142918 NA
#&gt; 11   oriole    robin 0.9330682 NA
#&gt; 12   oriole  tanager 8.1985162 NA
#&gt; 13 parakeet    robin 5.9812236 NA
#&gt; 14 parakeet  tanager 1.2842244 NA
#&gt; 15    robin  tanager 7.2654480 NA</code></pre>
<p>Where <code>dS</code> is the chromatic contrast (<span class="math inline">\(\Delta S\)</span>) and <code>dL</code> is the achromatic contrast (<span class="math inline">\(\Delta L\)</span>). Note that, by default, <code>achromatic = FALSE</code>, so <code>dL</code> isn’t included in the second result (this is to maintain consistency since, in the <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code> function, the <code>achromatic</code> argument defaults to <code>none</code>). As expected, values are really high under the avian colour vision, since the colours of these species are quite different and because of the enhanced discriminatory ability with four compared to two cones.</p>
<p><code><a href="http://pavo.colrverse.com/reference/coldist.html">coldist()</a></code> also has a <code>subset</code> argument, which is useful if only certain comparisons are of interest (for example, of colour patches against a background, or only comparisons among a species or body patch). <code>subset</code> can be a vector of length one or two. If only one subsetting option is passed, all comparisons against the matching argument are returned (useful in the case of comparing to a background, for example). If two values are passed, comparisons will only be made between samples that match that rule (partial string matching and regular expressions are accepted). For example, compare:</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="http://pavo.colrverse.com/reference/coldist.html">coldist</a></span><span class="op">(</span><span class="va">vismod1</span>, subset <span class="op">=</span> <span class="st">"cardinal"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;     patch1   patch2        dS dL
#&gt; 1 cardinal   jacana  8.436191 NA
#&gt; 2 cardinal   oriole  7.874540 NA
#&gt; 3 cardinal parakeet  8.010167 NA
#&gt; 4 cardinal    robin  5.865464 NA
#&gt; 5 cardinal  tanager 10.116173 NA</code></pre>
<p>to:</p>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="http://pavo.colrverse.com/reference/coldist.html">coldist</a></span><span class="op">(</span><span class="va">vismod1</span>, subset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cardinal"</span>, <span class="st">"jacana"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;     patch1 patch2       dS dL
#&gt; 1 cardinal jacana 8.436191 NA</code></pre>
<p>A bootstrap-based variant of <code><a href="http://pavo.colrverse.com/reference/coldist.html">coldist()</a></code>, described in <span class="citation">Maia and White (<a href="references.html#ref-Maia2018">2018</a>)</span> as part of a more general analytical framework, is implemented via the function <code><a href="http://pavo.colrverse.com/reference/bootcoldist.html">bootcoldist()</a></code>. As the name suggests, <code><a href="http://pavo.colrverse.com/reference/bootcoldist.html">bootcoldist()</a></code> uses a bootstrap procedure to generate confidence intervals for the mean chromatic and/or achromatic distance between two or more samples of colours. This has the benefit of generating useful errors around distance estimates, and may also be inspected for the inclusion of an appropriate ‘threshold’, when asking common kinds of questions that relate to between-group differences (e.g. animals-vs-backgrounds, sexual dichromatism, colour polymorphism). The function’s arguments are shared with <code><a href="http://pavo.colrverse.com/reference/coldist.html">coldist()</a></code> save for a few extra requirements. For one, the <code>by</code> argument is used to specify a grouping variable that defines the groups to be compared, while <code>boot.n</code> and <code>alpha</code> control the number of bootstrap replicates and the confidence level for the confidence interval, respectively. The latter two have sensible defaults, but the <code>by</code> argument is required.</p>
<p>Here we run present a quick example that tests for colour differences across three body regions (breast, crown, and throat) of the finch <em>Sicalis citrina</em>, given seven measures of each region from different males.</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">sicalis</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Construct a model using an avian viewer</span></span>
<span><span class="va">sicmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">sicalis</span>, visual <span class="op">=</span> <span class="st">"avg.uv"</span>, relative <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a grouping variable to group by body region,</span></span>
<span><span class="co"># informed by the spectral data names</span></span>
<span><span class="va">regions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sicmod</span><span class="op">)</span>, <span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate bootstrapped colour-distances</span></span>
<span><span class="va">sicdist</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/bootcoldist.html">bootcoldist</a></span><span class="op">(</span><span class="va">sicmod</span>,</span>
<span>  by <span class="op">=</span> <span class="va">regions</span>,</span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  weber <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Take a look at the resulting pairwise estimates</span></span>
<span><span class="va">sicdist</span></span></code></pre></div>
<pre><code>#&gt;       dS.mean    dS.lwr    dS.upr
#&gt; B-C  9.253097 5.7015179 14.013095
#&gt; B-T  3.483528 0.3728945  9.509223
#&gt; C-T 12.221038 8.1736179 16.899949</code></pre>
<p>And plot the results for good measure. We can see that the pairwise comparisons of the chest, breast, and throat are quite chromatically distinct, but the breast and throat are much more similar in colour, perhaps to the point of being indistinguishable.</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sicdist</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">21</span>,</span>
<span>  bg <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  cex <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  xaxt <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Centroid comparison"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Chromatic contrast (dS)"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sicdist</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="va">sicdist</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="va">sicdist</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># Add CI's</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">1</span>, lty <span class="op">=</span> <span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># Add a 'threshold' line at dS = 1</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-61"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-61-1.png" alt="The bootstrapped colour distances between the throat, chest, and breast regions of male Sicalis citrina." width="480"><p class="caption">
Figure 3.5: The bootstrapped colour distances between the throat, chest, and breast regions of male Sicalis citrina.
</p>
</div>
</div>
<div id="converting-receptor-noise-corrected-distances-to-cartesian-coordinates" class="section level5" number="3.1.4.5.3">
<h5>
<span class="header-section-number">3.1.4.5.3</span> Converting receptor noise-corrected distances to Cartesian coordinates<a class="anchor" aria-label="anchor" href="#converting-receptor-noise-corrected-distances-to-cartesian-coordinates"><i class="fas fa-link"></i></a>
</h5>
<p>You can convert noise-corrected Euclidean distances to coordinates in Cartesian ‘noise-corrected space’ with the function <code><a href="http://pavo.colrverse.com/reference/jnd2xyz.html">jnd2xyz()</a></code>. In this space, the distance between points corresponds exactly to their noise-corrected Euclidean distance as estimated under the receptor-noise limited model. Note that the absolute position of these points in the XYZ space is arbitrary, however, therefore the function allows you to rotate the data so that, for example, the vector leading to the long-wavelength cone aligns with the X axis:</p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fakedata1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span>, by <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">300</span><span class="op">:</span><span class="fl">700</span>, <span class="va">x</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">300</span><span class="op">:</span><span class="fl">700</span>, <span class="va">x</span> <span class="op">+</span> <span class="fl">400</span>, <span class="fl">30</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">401</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Creating idealized specs with varying saturation</span></span>
<span><span class="va">fakedata2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">300</span>, <span class="fl">150</span>, <span class="fl">105</span>, <span class="fl">75</span>, <span class="fl">55</span>, <span class="fl">40</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">300</span><span class="op">:</span><span class="fl">700</span>, <span class="fl">550</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">401</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fakedata1</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/as.rspec.html">as.rspec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>wl <span class="op">=</span> <span class="fl">300</span><span class="op">:</span><span class="fl">700</span>, <span class="va">fakedata1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fakedata1</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/procspec.html">procspec</a></span><span class="op">(</span><span class="va">fakedata1</span>, <span class="st">"max"</span><span class="op">)</span></span>
<span><span class="va">fakedata2</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/as.rspec.html">as.rspec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>wl <span class="op">=</span> <span class="fl">300</span><span class="op">:</span><span class="fl">700</span>, <span class="va">fakedata2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fakedata2</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/procspec.html">procspec</a></span><span class="op">(</span><span class="va">fakedata2</span>, <span class="st">"sum"</span><span class="op">)</span></span>
<span><span class="va">fakedata2</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/procspec.html">procspec</a></span><span class="op">(</span><span class="va">fakedata2</span>, <span class="st">"min"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Converting reflectance to percentage</span></span>
<span><span class="va">fakedata1</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fakedata1</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="va">fakedata2</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fakedata2</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">fakedata2</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span></span>
<span><span class="co"># Combining and converting to rspec</span></span>
<span><span class="va">fakedata.c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  wl <span class="op">=</span> <span class="fl">300</span><span class="op">:</span><span class="fl">700</span>,</span>
<span>  <span class="va">fakedata1</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="va">fakedata2</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fakedata.c</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/as.rspec.html">as.rspec</a></span><span class="op">(</span><span class="va">fakedata.c</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visual model and colour distances</span></span>
<span><span class="va">fakedata.vm</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">fakedata.c</span>,</span>
<span>  relative <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  achromatic <span class="op">=</span> <span class="st">"all"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fakedata.cd</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/coldist.html">coldist</a></span><span class="op">(</span><span class="va">fakedata.vm</span>,</span>
<span>  noise <span class="op">=</span> <span class="st">"neural"</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  weber <span class="op">=</span> <span class="fl">0.1</span>, achromatic <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Converting to Cartesian coordinates</span></span>
<span><span class="va">fakedata.cc</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/jnd2xyz.html">jnd2xyz</a></span><span class="op">(</span><span class="va">fakedata.cd</span>,</span>
<span>  ref1 <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>  axis1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  ref2 <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">fakedata.cc</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;             x          y         z      lum
#&gt; X1 -26.165302   3.692783 -17.71718 1.430788
#&gt; X2 -11.212399  -2.085407 -27.97937 2.315951
#&gt; X3   3.076291  -7.441594 -37.76761 3.621349
#&gt; X4  16.523287 -12.475488 -46.33606 4.341465
#&gt; X5  25.812150 -17.848152 -40.71621 4.444027
#&gt; X6  31.912643 -23.368560 -24.79660 4.046863</code></pre>
<p>which you can then plot as well:</p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fakedata.cc</span>,</span>
<span>  theta <span class="op">=</span> <span class="fl">55</span>,</span>
<span>  phi <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/spec2rgb.html">spec2rgb</a></span><span class="op">(</span><span class="va">fakedata.c</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-64"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-64-1.png" alt="Spectral data in a receptor noise-corrected colourspace" width="384"><p class="caption">
Figure 3.6: Spectral data in a receptor noise-corrected colourspace
</p>
</div>
<p>The axes in this colourspace denote noise-corrected Euclidean distances. For more information on these functions, see <code><a href="http://pavo.colrverse.com/reference/jnd2xyz.html">?jnd2xyz</a></code>, <code><a href="http://pavo.colrverse.com/reference/jndrot.html">?jndrot</a></code> and <code><a href="http://pavo.colrverse.com/reference/jndplot.html">?jndplot</a></code>.</p>
</div>
</div>
<div id="colourspaces" class="section level4" number="3.1.4.6">
<h4>
<span class="header-section-number">3.1.4.6</span> Colourspaces<a class="anchor" aria-label="anchor" href="#colourspaces"><i class="fas fa-link"></i></a>
</h4>
<p>Another general, flexible way in which to represent stimuli is via a colourspace model. Under such models photon catches are expressed in relative values (so that the quantum catches of all receptors involved in chromatic discrimination sum to 1). The maximum stimulation of each cone <span class="math inline">\(n\)</span> is placed at the vertex of a <span class="math inline">\((n-1)\)</span>-dimensional polygon that encompasses all theoretical colours that can be perceived by that visual system. For the avian visual system comprised of four cones, for example, all colours can be placed somewhere in the volume of a tetrahedron, in which each of the four vertices represents the maximum stimulation of that particular cone type.</p>
<p>Though these models do not account for receptor noise (and thus do not allow an estimate of noise-weighted distances), they presents several advantages. First, they make for a very intuitive representation of colour points accounting for attributes of the colour vision of the signal receiver. Second, they allow for the calculation of several interesting variables that represent colour. For example, hue can be estimated from the angle of the point relative to the xy plane (blue-green-red) and the z axis (UV); saturation can be estimated as the distance of the point from the achromatic centre.</p>
<p><code>data(flowers)</code> is a new example dataset consisting of reflectance spectra from 36 Australian angiosperm species, which we’ll use to illustrate for the following colourspace modelling.</p>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">flowers</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">flowers</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;    wl Goodenia_heterophylla Goodenia_geniculata Goodenia_gracilis
#&gt; 1 300             1.7426387            1.918962         0.3638354
#&gt; 2 301             1.5724849            1.872966         0.3501921
#&gt; 3 302             1.4099808            1.828019         0.3366520
#&gt; 4 303             1.2547709            1.784152         0.3231911
#&gt; 5 304             1.1064997            1.741398         0.3097854
#&gt; 6 305             0.9648117            1.699792         0.2964107</code></pre>
<div id="di--tri--and-tetrachromatic-colourspaces" class="section level5" number="3.1.4.6.1">
<h5>
<span class="header-section-number">3.1.4.6.1</span> Di-, Tri-, and Tetrachromatic Colourspaces<a class="anchor" aria-label="anchor" href="#di--tri--and-tetrachromatic-colourspaces"><i class="fas fa-link"></i></a>
</h5>
<p><code>pavo</code> has extensive modelling and visualisation capabilities for generic di-, tri-, and tetra-chromatic spaces, uniting these approaches in a cohesive workflow. As with most colourspace models, we first estimate relative quantum catches with various assumptions by using the <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code> function, before converting each set of values to a location in colourspace by using the <code>space</code> argument in <code><a href="http://pavo.colrverse.com/reference/colspace.html">colspace()</a></code> (the function can also be set to try to detect the dimensionality of the colourspace automatically). For di- tri- and tetrachromatic spaces, <code><a href="http://pavo.colrverse.com/reference/colspace.html">colspace()</a></code> calculates the coordinates of stimuli as:</p>
<p><strong>Dichromats:</strong>
<span class="math display">\[x = \frac{1}{\sqrt{2}}(Q_l - Q_s)\]</span></p>
<p><strong>Trichromats:</strong></p>
<p><span class="math display">\[
\begin{split}
x &amp;= \frac{1}{\sqrt{2}}(Q_l - Q_m) \\
y &amp;= \frac{\sqrt{2}}{\sqrt{3}}(Q_s - \frac{Q_l + Q_m}{2})
\end{split}
\]</span>
<strong>Tetrachromats:</strong></p>
<p><span class="math display">\[
\begin{split}
x &amp;= \frac{1}{\sqrt{2}}(Q_l - Q_m) \\
y &amp;= \frac{\sqrt{2}}{\sqrt{3}}(Q_s - \frac{Q_l + Q_m}{2})
z &amp;= \frac{\sqrt{3}}{2}(Q_u - \frac{Q_l + Q_m + Q_s}{3})
\end{split}
\]</span></p>
<p>Where <span class="math inline">\(Q_u\)</span>, <span class="math inline">\(Q_s\)</span>, <span class="math inline">\(Q_m\)</span>, and <span class="math inline">\(Q_l\)</span> refer to quantum catch estimates for UV-, short, medium-, and long-wavelength photoreceptors, respectively.</p>
<p>For a dichromatic example, we can model our floral reflectance data using the visual system of the domestic dog <em>Canis familiaris</em>, which has two cones with maximal sensitivity near 440 and 560 nm.</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vis.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">flowers</span>, visual <span class="op">=</span> <span class="st">"canis"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">di.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="va">vis.flowers</span>, space <span class="op">=</span> <span class="st">"di"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">di.flowers</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;                                s         l           x      r.vec
#&gt; Goodenia_heterophylla 0.52954393 0.4704561 -0.04178143 0.04178143
#&gt; Goodenia_geniculata   0.25430150 0.7456985  0.34747015 0.34747015
#&gt; Goodenia_gracilis     0.01747832 0.9825217  0.68238870 0.68238870
#&gt; Xyris_operculata      0.39433933 0.6056607  0.14942675 0.14942675
#&gt; Eucalyptus_sp         0.40628552 0.5937145  0.13253229 0.13253229
#&gt; Faradaya_splendida    0.23166580 0.7683342  0.37948187 0.37948187
#&gt;                       lum
#&gt; Goodenia_heterophylla  NA
#&gt; Goodenia_geniculata    NA
#&gt; Goodenia_gracilis      NA
#&gt; Xyris_operculata       NA
#&gt; Eucalyptus_sp          NA
#&gt; Faradaya_splendida     NA</code></pre>
<p>The output contains values for the relative stimulation of short- and long-wavelength sensitive photoreceptors associated with each flower, along with its single coordinate in dichromatic space and its r.vector (distance from the origin). To visualise where these points lie, we can simply plot them on a segment.</p>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">di.flowers</span>, col <span class="op">=</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/spec2rgb.html">spec2rgb</a></span><span class="op">(</span><span class="va">flowers</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-67"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-67-1.png" alt="Flowers in a dichromatic colourspace, as modelled according to a canid visual system." width="384"><p class="caption">
Figure 3.7: Flowers in a dichromatic colourspace, as modelled according to a canid visual system.
</p>
</div>
<p>For our trichromatic viewer we can use the honeybee <em>Apis mellifera</em>, one of the most significant and widespread pollinators. We’ll also transform our quantum catches according to Fechner’s law by specifying <code>qcatch = 'fi'</code>, and will model photoreceptor stimulation under bright conditions by scaling our illuminant with the <code>scale</code> argument.</p>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vis.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">flowers</span>,</span>
<span>  visual <span class="op">=</span> <span class="st">"apis"</span>,</span>
<span>  qcatch <span class="op">=</span> <span class="st">"fi"</span>,</span>
<span>  scale <span class="op">=</span> <span class="fl">10000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tri.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="va">vis.flowers</span>, space <span class="op">=</span> <span class="st">"tri"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tri.flowers</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;                               s         m         l            x
#&gt; Goodenia_heterophylla 0.2882383 0.3587254 0.3530363 -0.004022828
#&gt; Goodenia_geniculata   0.2475326 0.3549832 0.3974842  0.030052720
#&gt; Goodenia_gracilis     0.1373117 0.3125304 0.5501579  0.168028001
#&gt; Xyris_operculata      0.2395035 0.3729820 0.3875145  0.010275990
#&gt; Eucalyptus_sp         0.2760091 0.3548096 0.3691813  0.010162377
#&gt; Faradaya_splendida    0.2654951 0.3431266 0.3913783  0.034119147
#&gt;                                 y    h.theta      r.vec lum
#&gt; Goodenia_heterophylla -0.05522995 -1.6435057 0.05537626  NA
#&gt; Goodenia_geniculata   -0.10508396 -1.2922439 0.10929687  NA
#&gt; Goodenia_gracilis     -0.24007647 -0.9601417 0.29303604  NA
#&gt; Xyris_operculata      -0.11491764 -1.4816131 0.11537616  NA
#&gt; Eucalyptus_sp         -0.07020755 -1.4270471 0.07093922  NA
#&gt; Faradaya_splendida    -0.08308452 -1.1811377 0.08981733  NA</code></pre>
<p>As in the case of our dichromat, the output contains relative photoreceptor stimulations, coordinates in the Maxwell triangle, as well as the ‘hue angle’ <code>h.theta</code> and distance from the origin (<code>r.vec</code>).</p>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tri.flowers</span>, pch <span class="op">=</span> <span class="fl">21</span>, bg <span class="op">=</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/spec2rgb.html">spec2rgb</a></span><span class="op">(</span><span class="va">flowers</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-69"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-69-1.png" alt="Floral reflectance in a Maxwell triangle, considering a honeybee visual system." width="384"><p class="caption">
Figure 3.8: Floral reflectance in a Maxwell triangle, considering a honeybee visual system.
</p>
</div>
<p>Finally, we’ll draw on the blue tit’s visual system to model our floral reflectance spectra in a tetrahedral space, again using log-transformed quantum catches and assuming bright viewing conditions.</p>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vis.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">flowers</span>,</span>
<span>  visual <span class="op">=</span> <span class="st">"bluetit"</span>,</span>
<span>  qcatch <span class="op">=</span> <span class="st">"fi"</span>,</span>
<span>  scale <span class="op">=</span> <span class="fl">10000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tetra.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="va">vis.flowers</span>, space <span class="op">=</span> <span class="st">"tcs"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tetra.flowers</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;                               u         s         m         l
#&gt; Goodenia_heterophylla 0.2274310 0.2659669 0.2524170 0.2541851
#&gt; Goodenia_geniculata   0.1625182 0.2721621 0.2828016 0.2825182
#&gt; Goodenia_gracilis     0.0428552 0.2443091 0.3504414 0.3623943
#&gt; Xyris_operculata      0.1766234 0.2709785 0.2642637 0.2881344
#&gt; Eucalyptus_sp         0.2118481 0.2609468 0.2637023 0.2635028
#&gt; Faradaya_splendida    0.1844183 0.2557660 0.2786393 0.2811764
#&gt;                               u.r          s.r         m.r
#&gt; Goodenia_heterophylla -0.02256897  0.015966893 0.002417012
#&gt; Goodenia_geniculata   -0.08748184  0.022162064 0.032801599
#&gt; Goodenia_gracilis     -0.20714480 -0.005690920 0.100441373
#&gt; Xyris_operculata      -0.07337659  0.020978454 0.014263689
#&gt; Eucalyptus_sp         -0.03815190  0.010946788 0.013702317
#&gt; Faradaya_splendida    -0.06558169  0.005765955 0.028639328
#&gt;                               l.r            x            y
#&gt; Goodenia_heterophylla 0.004185066 -0.007214866 -0.005415708
#&gt; Goodenia_geniculata   0.032518179  0.006341799  0.003861848
#&gt; Goodenia_gracilis     0.112394348  0.072312163  0.033297418
#&gt; Xyris_operculata      0.038134446  0.010505857 -0.010813615
#&gt; Eucalyptus_sp         0.013502794  0.001565228  0.001044768
#&gt; Faradaya_splendida    0.031176408  0.015560661  0.007189965
#&gt;                                 z    h.theta     h.phi      r.vec
#&gt; Goodenia_heterophylla -0.02256897 -2.4976873 -1.190529 0.02430520
#&gt; Goodenia_geniculata   -0.08748184  0.5469755 -1.486123 0.08779638
#&gt; Goodenia_gracilis     -0.20714480  0.4315247 -1.203879 0.22191605
#&gt; Xyris_operculata      -0.07337659 -0.7998327 -1.368146 0.07490949
#&gt; Eucalyptus_sp         -0.03815190  0.5885699 -1.521510 0.03819828
#&gt; Faradaya_splendida    -0.06558169  0.4328380 -1.315140 0.06778487
#&gt;                           r.max r.achieved lum
#&gt; Goodenia_heterophylla 0.2692325 0.09027589  NA
#&gt; Goodenia_geniculata   0.2508989 0.34992737  NA
#&gt; Goodenia_gracilis     0.2678272 0.82857920  NA
#&gt; Xyris_operculata      0.2552227 0.29350636  NA
#&gt; Eucalyptus_sp         0.2503039 0.15260760  NA
#&gt; Faradaya_splendida    0.2583986 0.26232676  NA</code></pre>
<p>Tetrahedral data (via <code>colspace(space = 'tcs')</code>) may be plotted in a standard <em>static</em> tetrahedron by using <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>, or can be visualised as part of an <em>interactive</em> tetrahedron by using <code><a href="http://pavo.colrverse.com/reference/tcsplot.html">tcsplot()</a></code> with the accessory functions <code><a href="http://pavo.colrverse.com/reference/tcsplot.html">tcspoints()</a></code> and <code><a href="http://pavo.colrverse.com/reference/tcsplot.html">tcsvol()</a></code> for adding points and convex hulls, respectively. As with other colourspace plots there are a number of associated graphical options, though the <code>theta</code> and <code>phi</code> arguments are particularly useful in this case, as they control the orientation (in degrees) of the tetrahedron in the xy and yz planes, respectively.</p>
<p>When plotting the tetrahedral colourspace, one can also force perspective by changing the size of points relative to their distance from the plane of observation, using the arguments <code>perspective = TRUE</code> and controlling the size range with the <code>range</code> argument. Several other options control the appearance of this plot, you can check these using <code><a href="http://pavo.colrverse.com/reference/plot.colspace.html">?plot.colspace</a></code> or <code><a href="http://pavo.colrverse.com/reference/tetraplot.html">?tetraplot</a></code></p>
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tetra.flowers</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">21</span>,</span>
<span>  bg <span class="op">=</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/spec2rgb.html">spec2rgb</a></span><span class="op">(</span><span class="va">flowers</span><span class="op">)</span>,</span>
<span>  perspective <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  cex <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-71"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-71-1.png" alt="Flowers in a tetrahedral colourspace modelled using the visual phenotype of the blue tit. Point size is used to force perspective" width="480"><p class="caption">
Figure 3.9: Flowers in a tetrahedral colourspace modelled using the visual phenotype of the blue tit. Point size is used to force perspective
</p>
</div>
<p>Two additional functions may help with tetrahedral colourspace plotting:</p>
<ul>
<li>
<code><a href="http://pavo.colrverse.com/reference/axistetra.html">axistetra()</a></code> function can be used to draw arrows showing the direction and magnitude of distortion of x, y and z in the tetrahedral plot.</li>
<li>
<code><a href="http://pavo.colrverse.com/reference/legendtetra.html">legendtetra()</a></code> allows you to add a legend to a plot.</li>
</ul>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tetra.flowers</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">21</span>,</span>
<span>  bg <span class="op">=</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/spec2rgb.html">spec2rgb</a></span><span class="op">(</span><span class="va">flowers</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="http://pavo.colrverse.com/reference/axistetra.html">axistetra</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">1.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tetra.flowers</span>,</span>
<span>  theta <span class="op">=</span> <span class="fl">110</span>,</span>
<span>  phi <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">21</span>,</span>
<span>  bg <span class="op">=</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/spec2rgb.html">spec2rgb</a></span><span class="op">(</span><span class="va">flowers</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="http://pavo.colrverse.com/reference/axistetra.html">axistetra</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">1.8</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-72"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-72-1.png" alt="Flowers in a tetrahedral colourspace, with varied orientations and perspectives, modelled using the visual phenotype of the blue tit." width="45%"><img src="colsci-book_files/figure-html/unnamed-chunk-72-2.png" alt="Flowers in a tetrahedral colourspace, with varied orientations and perspectives, modelled using the visual phenotype of the blue tit." width="45%"><p class="caption">
Figure 3.10: Flowers in a tetrahedral colourspace, with varied orientations and perspectives, modelled using the visual phenotype of the blue tit.
</p>
</div>
<p>For tetrahedral models, another plotting option available is <code>projplot</code>, which projects colour points in the surface of a sphere encompassing the tetrahedron. This plot is particularly useful to see differences in hue.</p>
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="http://pavo.colrverse.com/reference/projplot.html">projplot</a></span><span class="op">(</span><span class="va">tetra.flowers</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/spec2rgb.html">spec2rgb</a></span><span class="op">(</span><span class="va">flowers</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-73"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-73-1.png" alt="Projection plot from a tetrahedral colour space." width="480"><p class="caption">
Figure 3.11: Projection plot from a tetrahedral colour space.
</p>
</div>
<p><strong>Estimating colour volumes</strong></p>
<p>A further useful function for tri- and tetrahedral models is <code><a href="http://pavo.colrverse.com/reference/voloverlap.html">voloverlap()</a></code>, which calculates the overlap in tri- or tetrahedral colour volume between two sets of points. This can be useful to explore whether different species occupy similar (overlapping) or different (non- overlapping) “sensory niches”, or to test for mimetism, dichromatism, etc. <span class="citation">(<a href="references.html#ref-Stoddard2011">Stoddard and Stevens 2011</a>)</span>. To demonstrate, we will use the <code>sicalis</code> dataset, which includes measurements from the crown (C), throat (T) and breast (B) of seven stripe-tailed yellow finches (<em>Sicalis citrina</em>).</p>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">sicalis</span><span class="op">)</span></span></code></pre></div>
<p>We will use this dataset to test for the overlap between the volume determined by the measurements of those body parts from multiple individuals in the tetrahedral colourspace (note the option <code>plot</code> for plotting of the volumes):</p>
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tcs.sicalis.C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">sicalis</span><span class="op">)</span><span class="op">)</span>, <span class="st">"C"</span><span class="op">)</span></span>
<span><span class="va">tcs.sicalis.T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">sicalis</span><span class="op">)</span><span class="op">)</span>, <span class="st">"T"</span><span class="op">)</span></span>
<span><span class="va">tcs.sicalis.B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">sicalis</span><span class="op">)</span><span class="op">)</span>, <span class="st">"B"</span><span class="op">)</span></span>
<span><span class="fu"><a href="http://pavo.colrverse.com/reference/voloverlap.html">voloverlap</a></span><span class="op">(</span><span class="va">tcs.sicalis.T</span>, <span class="va">tcs.sicalis.B</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;           vol1         vol2   overlapvol vsmallest      vboth
#&gt; 1 5.183721e-06 6.281511e-06 6.904074e-07 0.1331876 0.06407598</code></pre>
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="http://pavo.colrverse.com/reference/voloverlap.html">voloverlap</a></span><span class="op">(</span><span class="va">tcs.sicalis.T</span>, <span class="va">tcs.sicalis.C</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;           vol1         vol2 overlapvol vsmallest vboth
#&gt; 1 5.183721e-06 4.739152e-06          0         0     0</code></pre>
<p><img src="colsci-book_files/figure-html/unnamed-chunk-75-1.png" width="40%" style="display: block; margin: auto;"><img src="colsci-book_files/figure-html/unnamed-chunk-75-2.png" width="40%" style="display: block; margin: auto;"></p>
<p>The function <code><a href="http://pavo.colrverse.com/reference/voloverlap.html">voloverlap()</a></code> gives the volume (<span class="math inline">\(V\)</span>) of the convex hull delimited by the overlap between the two original volumes, and two proportions are calculated from that: <span class="math display">\[\text{vsmallest} = V_{overlap} / \min(V_A, V_B)\]</span> and <span class="math display">\[\text{vboth} = V_{overlap} / (V_A + V_B)\]</span>. Thus, if one of the volumes is entirely contained in the other, <code>vsmallest</code> will equal 1. So we can clearly see that there is overlap between the throat and breast colours (of about 6%), but not between the throat and the crown colours (Figures above).</p>
<p>Alternatively, <span class="math inline">\(\alpha\)</span>-shapes are a new tool available in <code>pavo</code> to estimate colour volumes,
while allowing the presence of voids and pockets. <span class="math inline">\(\alpha\)</span>-shapes may thus lead to a more
accurate measurement of “colourfulness” than convex hulls. For more information
on the theoretical background, please report to the related article <span class="citation">(<a href="references.html#ref-Gruson2020">Gruson 2020</a>)</span>.</p>
<p>You can plot the colour volume using <span class="math inline">\(\alpha\)</span>-shape with the <code><a href="http://pavo.colrverse.com/reference/vol.html">vol()</a></code> function
(for non-interactive plots, <code><a href="http://pavo.colrverse.com/reference/tcsplot.html">tcsvol()</a></code> otherwise) by specifying
<code>type = "alpha"</code>. By default, this will use the <span class="math inline">\(\alpha^*\)</span> value defined in
<span class="citation">Gruson (<a href="references.html#ref-Gruson2020">2020</a>)</span>.</p>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">flowers</span><span class="op">)</span></span>
<span><span class="va">vis_flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">flowers</span>, visual <span class="op">=</span> <span class="st">"avg.uv"</span><span class="op">)</span></span>
<span><span class="va">tcs_flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="va">vis_flowers</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tcs_flowers</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="colsci-book_files/figure-html/unnamed-chunk-77-1.png" width="672" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="http://pavo.colrverse.com/reference/vol.html">vol</a></span><span class="op">(</span><span class="va">tcs_flowers</span>, type <span class="op">=</span> <span class="st">"alpha"</span><span class="op">)</span></span></code></pre></div>
<pre class="cw"><code>#&gt; Warning in rgl.init(initValue, onlyNULL): RGL: unable to open X11
#&gt; display</code></pre>
<pre class="cw"><code>#&gt; Warning: 'rgl.init' failed, running with 'rgl.useNULL = TRUE'.</code></pre>
<pre class="cm"><code>#&gt; 'avalue' automatically set to 1.8275e-01</code></pre>
<div class="inline-figure"><img src="colsci-book_files/figure-html/unnamed-chunk-78-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Alternatively, you can set the <span class="math inline">\(\alpha\)</span> parameter to the value of your choice via the <code>avalue</code>
argument:</p>
<div class="sourceCode" id="cb166"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tcs_flowers</span><span class="op">)</span></span>
<span><span class="fu"><a href="http://pavo.colrverse.com/reference/vol.html">vol</a></span><span class="op">(</span><span class="va">tcs_flowers</span>, type <span class="op">=</span> <span class="st">"alpha"</span>, avalue <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="colsci-book_files/figure-html/unnamed-chunk-80-1.png" width="672" style="display: block; margin: auto;"></div>
<p>In the previous examples, we focused on <span class="math inline">\(\alpha\)</span>-shapes in chromaticity diagrams since
it is the most common space where convex hulls (that <span class="math inline">\(\alpha\)</span>-shapes aim at
replacing) are used. But it is also possible to use <span class="math inline">\(\alpha\)</span>-shapes in other spaces,
such as perceptually uniform (noise-corrected) spaces.</p>
<p>Let’s first build this uniform space and look at the data points in this space:</p>
<div class="sourceCode" id="cb167"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cd_flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/coldist.html">coldist</a></span><span class="op">(</span><span class="va">vis_flowers</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; Quantum catch are relative, distances may not be meaningful</code></pre>
<pre class="cm"><code>#&gt; Calculating noise-weighted Euclidean distances</code></pre>
<div class="sourceCode" id="cb170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xy_flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/jnd2xyz.html">jnd2xyz</a></span><span class="op">(</span><span class="va">cd_flowers</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">xy_flowers</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="colsci-book_files/figure-html/unnamed-chunk-81-1.png" width="672" style="display: block; margin: auto;"></div>
<p>High-level functions to build the <span class="math inline">\(\alpha\)</span>-shape directly in <code>pavo</code> have not yet
been implemented but you can use the <code>alphashape3d</code> package directly to compute
the <span class="math inline">\(\alpha\)</span>-shapes, its volume and display it in a 3D interactive plot.</p>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">alphashape3d</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; Loading required package: geometry</code></pre>
<pre class="cm"><code>#&gt; Loading required package: rgl</code></pre>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ashape_jnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/alphashape3d/man/ashape3d.html">ashape3d</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">xy_flowers</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/alphashape3d/man/volume_ashape3d.html">volume_ashape3d</a></span><span class="op">(</span><span class="va">ashape_jnd</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; [1] 748.863</code></pre>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ashape_jnd</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; Device  1  : alpha =  10</code></pre>
<p><span class="math inline">\(\alpha\)</span>-shapes can also be used to measure the colour similarity of two objects,
by computing the colour volume overlap. This is done with the <code>type = "alpha"</code> argument
in <code><a href="http://pavo.colrverse.com/reference/voloverlap.html">voloverlap()</a></code>. For example, let’s compare ibce agaub the colour volume of the
crown and the breast of stripe-tailed yellow finches (<em>Sicalis citrina</em>),
but this time with <span class="math inline">\(\alpha\)</span>-shapes:</p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">sicalis</span><span class="op">)</span></span>
<span><span class="va">tcs.sicalis.C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">sicalis</span><span class="op">)</span><span class="op">)</span>, <span class="st">"C"</span><span class="op">)</span></span>
<span><span class="va">tcs.sicalis.B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">sicalis</span><span class="op">)</span><span class="op">)</span>, <span class="st">"B"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="http://pavo.colrverse.com/reference/voloverlap.html">voloverlap</a></span><span class="op">(</span><span class="va">tcs.sicalis.C</span>,</span>
<span>  <span class="va">tcs.sicalis.B</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"alpha"</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; 'avalue' automatically set to 2.4445e-02</code></pre>
<pre class="cm"><code>#&gt; 'avalue' automatically set to 2.6255e-01</code></pre>
<pre class="cw"><code>#&gt; Warning: interactive = FALSE has not been implemented yet,
#&gt; falling back tointeractive plot.</code></pre>
<pre><code>#&gt;           vol1         vol2 s_in1 s_in2 s_inboth s_ineither
#&gt; 1 1.849436e-06 4.586381e-06     2     4        0          6
#&gt;   psmallest pboth
#&gt; 1         0     0</code></pre>
<p><strong>Summary variables for groups of points</strong></p>
<p>Another advantage of colourspace models is that they allow for the calculation of useful summary statistics of groups of points, such as the centroid of the points, the total volume occupied (as above), the mean and variance of hue span and the mean saturation. In <code>pavo</code>, the result of a <code><a href="http://pavo.colrverse.com/reference/colspace.html">colspace()</a></code> call is an object of class <code>colspace</code>, and thus these summary statistics can be calculated simply by calling <code>summary</code>. Note that the <code>summary</code> call can also take a <code>by</code> vector of group identities, so that the variables are calculated for each group separately:</p>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">tetra.flowers</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; Colorspace &amp; visual model options:
#&gt;  * Colorspace: tcs 
#&gt;  * Quantal catch: fi 
#&gt;  * Visual system, chromatic: bluetit 
#&gt;  * Visual system, achromatic: none 
#&gt;  * Illuminant: ideal, scale = 10000 (von Kries colour correction not applied) 
#&gt;  * Background: ideal 
#&gt;  * Relative: TRUE 
#&gt;  * Max possible chromatic volume: NA</code></pre>
<pre class="cm"><code>#&gt; 'avalue' automatically set to 1.9861e-01</code></pre>
<pre><code>#&gt;            centroid.u centroid.s centroid.m centroid.l        c.vol
#&gt; all.points  0.1948478  0.2554421  0.2704411   0.279269 0.0002510915
#&gt;              rel.c.vol  colspan.m   colspan.v huedisp.m huedisp.v
#&gt; all.points 0.001159742 0.05706825 0.001682224 0.6413439 0.3157949
#&gt;              mean.ra    max.ra        a.vol
#&gt; all.points 0.2428508 0.8285792 0.0001723672</code></pre>
<p>It is important to highlight that oftentimes, the properties of the visual system and/or illuminant will make it impossible to reach the entirety of a given colourspace. You can view the maximum gamut of a given viewer by switching the <code>gamut</code> argument to <code>TRUE</code> in <code>plot.colspace()</code>:</p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vis.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">flowers</span>, visual <span class="op">=</span> <span class="st">"ctenophorus"</span><span class="op">)</span></span>
<span><span class="va">tri.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="va">vis.flowers</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tri.flowers</span>, pch <span class="op">=</span> <span class="fl">21</span>, bg <span class="op">=</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/spec2rgb.html">spec2rgb</a></span><span class="op">(</span><span class="va">flowers</span><span class="op">)</span>, gamut <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="colsci-book_files/figure-html/unnamed-chunk-89-1.png" width="672" style="display: block; margin: auto;"></div>
<p>This information is also available in the summary, in the “Max possible chromatic volume” line:</p>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">tri.flowers</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; Colorspace &amp; visual model options:
#&gt;  * Colorspace: trispace 
#&gt;  * Quantal catch: Qi 
#&gt;  * Visual system, chromatic: ctenophorus 
#&gt;  * Visual system, achromatic: none 
#&gt;  * Illuminant: ideal, scale = 1 (von Kries colour correction not applied) 
#&gt;  * Background: ideal 
#&gt;  * Relative: TRUE 
#&gt;  * Max possible chromatic volume: 0.4729301</code></pre>
<pre><code>#&gt;        s                 m                l         
#&gt;  Min.   :0.02084   Min.   :0.2318   Min.   :0.2066  
#&gt;  1st Qu.:0.18617   1st Qu.:0.3005   1st Qu.:0.3806  
#&gt;  Median :0.23206   Median :0.3452   Median :0.4180  
#&gt;  Mean   :0.23206   Mean   :0.3225   Mean   :0.4454  
#&gt;  3rd Qu.:0.29330   3rd Qu.:0.3513   3rd Qu.:0.5039  
#&gt;  Max.   :0.44720   Max.   :0.3660   Max.   :0.7474  
#&gt;        x                  y               h.theta       
#&gt;  Min.   :-0.09877   Min.   :-0.38273   Min.   :-1.9491  
#&gt;  1st Qu.: 0.02242   1st Qu.:-0.18023   1st Qu.:-1.2269  
#&gt;  Median : 0.05899   Median :-0.12404   Median :-0.9590  
#&gt;  Mean   : 0.08689   Mean   :-0.12404   Mean   :-0.5767  
#&gt;  3rd Qu.: 0.12564   3rd Qu.:-0.04903   3rd Qu.:-0.7747  
#&gt;  Max.   : 0.36460   Max.   : 0.13946   Max.   : 2.6273  
#&gt;      r.vec           lum         
#&gt;  Min.   :0.02264   Mode:logical  
#&gt;  1st Qu.:0.08330   NA's:36       
#&gt;  Median :0.13917                 
#&gt;  Mean   :0.17858                 
#&gt;  3rd Qu.:0.24002                 
#&gt;  Max.   :0.52860</code></pre>
</div>
<div id="the-colour-hexagon" class="section level5" number="3.1.4.6.2">
<h5>
<span class="header-section-number">3.1.4.6.2</span> The Colour Hexagon<a class="anchor" aria-label="anchor" href="#the-colour-hexagon"><i class="fas fa-link"></i></a>
</h5>
<p>The hexagon colour space of <span class="citation">Chittka (<a href="references.html#ref-Chittka1992">1992</a>)</span> is a generalised colour-opponent model of hymenopteran vision that has found extremely broad use, particularly in studies of bee-flower interactions. It’s also often broadly applied across hymenopteran species, because the photopigments underlying trichromatic vision in Hymenoptera appear to be quite conserved <span class="citation">(<a href="references.html#ref-Briscoe2001">Briscoe and Chittka 2001</a>)</span>. What’s particularly useful is that colour distances within the hexagon have been extensively validated against behaviour, at least among honeybees, and thus offer a relatively reliable measure of perceptual distance.</p>
<p>In the hexagon, photoreceptor quantum catches are typically hyperbolically transformed (and <code>pavo</code> will return a warning if the transform is not selected), and vonkries correction is often used used to model photoreceptor adaptation to a vegetation background. This can all now be specified in <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code>. including the optional use of a built-in ‘green’ vegetation background. Note that although this is a colourspace model, we specific <code>relative = FALSE</code> to return unnormalised quantum catches, as required for the model.</p>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vis.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">flowers</span>,</span>
<span>  visual <span class="op">=</span> <span class="st">"apis"</span>,</span>
<span>  qcatch <span class="op">=</span> <span class="st">"Ei"</span>,</span>
<span>  relative <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  vonkries <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  achromatic <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>  bkg <span class="op">=</span> <span class="st">"green"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can then apply the hexagon model in <code>colspace</code>, which will convert our photoreceptor excitation values to coordinates in the hexagon according to:</p>
<p><span class="math display">\[
\begin{split}
x &amp;= \frac{\sqrt{3}}{2(E_g + E_{uv})}\\
y &amp;= E_b - 0.5(E_{uv} + E_g)
\end{split}
\]</span></p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hex.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="va">vis.flowers</span>, space <span class="op">=</span> <span class="st">"hexagon"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">hex.flowers</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;                                s         m         l         x
#&gt; Goodenia_heterophylla 0.56572097 0.8237141 0.7053057 0.1208839
#&gt; Goodenia_geniculata   0.35761236 0.8176153 0.8670134 0.4411542
#&gt; Goodenia_gracilis     0.01888788 0.1622766 0.7810589 0.6600594
#&gt; Xyris_operculata      0.21080752 0.7345122 0.6796464 0.4060263
#&gt; Eucalyptus_sp         0.55622758 0.8515289 0.8208038 0.2291297
#&gt; Faradaya_splendida    0.45855056 0.7828905 0.8565895 0.3447118
#&gt;                                y   h.theta     r.vec sec.fine
#&gt; Goodenia_heterophylla  0.1882007  32.71320 0.2236793       30
#&gt; Goodenia_geniculata    0.2053024  65.04388 0.4865862       60
#&gt; Goodenia_gracilis     -0.2376968 109.80467 0.7015541      100
#&gt; Xyris_operculata       0.2892853  54.53092 0.4985412       50
#&gt; Eucalyptus_sp          0.1630132  54.57024 0.2812005       50
#&gt; Faradaya_splendida     0.1253205  70.02119 0.3667853       70
#&gt;                       sec.coarse       lum
#&gt; Goodenia_heterophylla  bluegreen 0.1680153
#&gt; Goodenia_geniculata    bluegreen 0.3548825
#&gt; Goodenia_gracilis          green 0.2313678
#&gt; Xyris_operculata       bluegreen 0.1518319
#&gt; Eucalyptus_sp          bluegreen 0.2787543
#&gt; Faradaya_splendida     bluegreen 0.3351008</code></pre>
<p>Again, the output includes the photoreceptor excitation values for short- medium- and long-wave sensitive photoreceptors, x and y coordinates, and measures of hue and saturation for each stimulus. The hexagon model also outputs two additional measures of of subjective ‘bee-hue’; <code>sec.fine</code> and <code>sec.coarse</code>. <code>sec.fine</code> describes the location of stimuli within one of 36 ‘hue sectors’ that are specified by radially dissecting the hexagon in 10-degree increments. <code>sec.coarse</code> follows a similar principle, though here the hexagon is divided into only five ‘bee-hue’ sectors: UV, UV-blue, blue, blue-green, green, and UV-green. These can easily be visualised by specifying <code>sectors = 'coarse</code> or <code>sectors = 'fine'</code> in a call to <code>plot</code> after modelling.</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hex.flowers</span>,</span>
<span>  sectors <span class="op">=</span> <span class="st">"coarse"</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">21</span>,</span>
<span>  bg <span class="op">=</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/spec2rgb.html">spec2rgb</a></span><span class="op">(</span><span class="va">flowers</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-93"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-93-1.png" alt="Flowers as modelled in the hymenopteran colour hexagon of Chittka (1992), overlain with coarse bee-hue sectors." width="480"><p class="caption">
Figure 3.12: Flowers as modelled in the hymenopteran colour hexagon of Chittka (1992), overlain with coarse bee-hue sectors.
</p>
</div>
<p>Note that ‘green receptor contrast’ (as per Spaethe (2001) and much subsequent work) in the hexagon model is often of interest, given its role in mediating the detection of stimuli at small visual angles. This is (by necessity) <strong>not</strong> the value returned as <code>lum</code> in the output of <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code>. Instead, ‘green contrast’ is simply the long-wavelength receptor excitation values returned (<code>l</code>), when both the long wavelength receptor is specified as the ‘achromatic’ receptor and the vonkries transform is applied (as above). In the literature, green contrast may be expressed as an absolute excitation value ranging 0-1, with 0.5 representing unity (i.e. no contrast), or as the relative deviation from 0.5.</p>
</div>
<div id="the-colour-opponent-coding-coc-space" class="section level5" number="3.1.4.6.3">
<h5>
<span class="header-section-number">3.1.4.6.3</span> The Colour Opponent Coding (COC) Space<a class="anchor" aria-label="anchor" href="#the-colour-opponent-coding-coc-space"><i class="fas fa-link"></i></a>
</h5>
<p>The colour opponent coding (coc) space is an earlier hymenopteran visual model <span class="citation">(<a href="references.html#ref-Backhaus1991">Backhaus 1991</a>)</span> which, although now seldom used in favour of the hexagon, may prove useful for comparative work. While the initial estimation of photoreceptor excitation is similar to that in the hexagon, the coc subsequently specifies <code>A</code> and <code>B</code> coordinates based on empirically-derived weights for the output from each photoreceptor:</p>
<p><span class="math display">\[
\begin{split}
A &amp;= -9.86E_u + 7.70E_b + 2.16E_g\\
B &amp;= -5.17E_u + 20.25E_b - 15.08E_g
\end{split}
\]</span></p>
<p>Where <span class="math inline">\(E_i\)</span> is the excitation value (hyperbolic-transformed quantum catch) in photoreceptor <span class="math inline">\(i\)</span>.</p>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vis.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">flowers</span>,</span>
<span>  visual <span class="op">=</span> <span class="st">"apis"</span>,</span>
<span>  qcatch <span class="op">=</span> <span class="st">"Ei"</span>,</span>
<span>  relative <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  vonkries <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  bkg <span class="op">=</span> <span class="st">"green"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">coc.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="va">vis.flowers</span>, space <span class="op">=</span> <span class="st">"coc"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">coc.flowers</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;                                s         m         l        x
#&gt; Goodenia_heterophylla 0.56572097 0.8237141 0.7053057 2.288050
#&gt; Goodenia_geniculata   0.35761236 0.8176153 0.8670134 4.642329
#&gt; Goodenia_gracilis     0.01888788 0.1622766 0.7810589 2.750382
#&gt; Xyris_operculata      0.21080752 0.7345122 0.6796464 5.045218
#&gt; Eucalyptus_sp         0.55622758 0.8515289 0.8208038 2.845304
#&gt; Faradaya_splendida    0.45855056 0.7828905 0.8565895 3.357182
#&gt;                                y     r.vec lum
#&gt; Goodenia_heterophylla  3.1194224  5.407473  NA
#&gt; Goodenia_geniculata    1.6332926  6.275622  NA
#&gt; Goodenia_gracilis     -8.5899171 11.340299  NA
#&gt; Xyris_operculata       3.5349309  8.580149  NA
#&gt; Eucalyptus_sp          1.9900420  4.835346  NA
#&gt; Faradaya_splendida     0.5654568  3.922638  NA</code></pre>
<p>The A and B coordinates are designated x and y in the output of coc for consistency, and while the model includes a measure of saturation in <code>r.vec</code>, it contains no associated measure of hue.</p>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">coc.flowers</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">21</span>,</span>
<span>  bg <span class="op">=</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/spec2rgb.html">spec2rgb</a></span><span class="op">(</span><span class="va">flowers</span><span class="op">)</span>,</span>
<span>  yaxt <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-95"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-95-1.png" alt="Flowers in the colour-opponent-coding space of Backhaus (1991), as modelling according to the honeybee." width="480"><p class="caption">
Figure 3.13: Flowers in the colour-opponent-coding space of Backhaus (1991), as modelling according to the honeybee.
</p>
</div>
</div>
<div id="cie-spaces" class="section level5" number="3.1.4.6.4">
<h5>
<span class="header-section-number">3.1.4.6.4</span> CIE Spaces<a class="anchor" aria-label="anchor" href="#cie-spaces"><i class="fas fa-link"></i></a>
</h5>
<p>The CIE (International Commission on Illumination) colourspaces are a suite of models of human colour vision and perception. <code>pavo 1.0</code> now includes two of the most commonly used: the foundational 1931 CIE XYZ space, and the more modern, perceptually calibrated CIE LAB space and its cylindrical CIE LCh transformation. Tristimulus values in XYZ space are calculated as:</p>
<p><span class="math display">\[
\begin{split}
X &amp;= k\int_{300}^{700}{R(\lambda)I(\lambda)\bar{x}(\lambda)\,d\lambda}\\
Y &amp;= k\int_{300}^{700}{R(\lambda)I(\lambda)\bar{y}(\lambda)\,d\lambda}\\
Z &amp;= k\int_{300}^{700}{R(\lambda)I(\lambda)\bar{z}(\lambda)\,d\lambda}
\end{split}
\]</span></p>
<p>where <em>x</em>, <em>y</em>, and <em>z</em> are the trichromatic colour matching functions for a ‘standard colourimetric viewer’. These functions are designed to describe an average human’s chromatic response within a specified viewing arc in the fovea (to account for the uneven distribution of cones across eye). <code>pavo</code> includes both the CIE 2-degree and the modern 10-degree standard observer, which can be selected in the <code>visual</code> option in the <code>vismodel</code> function. In these equations, k is the normalising factor</p>
<p><span class="math display">\[k = \frac{100}{\int_{300}^{700}{I(\lambda)\bar{y}(\lambda)\,d\lambda}}\]</span></p>
<p>and the chromaticity coordinates of stimuli are calculated as</p>
<p><span class="math display">\[
\begin{split}
x &amp;= \frac{X}{X + Y + Z}\\
y &amp;= \frac{Y}{X + Y + Z}\\
z &amp;= \frac{Z}{X + Y + Z} = 1 - x - y
\end{split}
\]</span></p>
<p>For modelling in both XYZ and LAB spaces, here we’ll use the CIE 10-degree standard observer, and assume a <code>D65</code> ‘standard daylight’ illuminant. Again, although they are colourspace models, we need to set <code>relative = FALSE</code> to return raw quantum catch estimates, <code>vonkries = TRUE</code> to account for the required normalising factor (as above), and <code>achromatic = 'none'</code> since there is no applicable way to estimate luminance in the CIE models. As with all models that have particular requirements, <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code> will output warnings and/or errors if unusual or non-standard arguments are specified.</p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vis.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">flowers</span>,</span>
<span>  visual <span class="op">=</span> <span class="st">"cie10"</span>,</span>
<span>  illum <span class="op">=</span> <span class="st">"D65"</span>,</span>
<span>  vonkries <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  relative <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  achromatic <span class="op">=</span> <span class="st">"none"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ciexyz.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="va">vis.flowers</span>, space <span class="op">=</span> <span class="st">"ciexyz"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ciexyz.flowers</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;                               X         Y          Z         x
#&gt; Goodenia_heterophylla 0.2095846 0.2074402 0.30060475 0.2920513
#&gt; Goodenia_geniculata   0.6415362 0.6751982 0.42423209 0.3684943
#&gt; Goodenia_gracilis     0.5027874 0.4538738 0.01742707 0.5161620
#&gt; Xyris_operculata      0.2847275 0.2325247 0.22131809 0.3855117
#&gt; Eucalyptus_sp         0.4421178 0.4469747 0.40173521 0.3425072
#&gt; Faradaya_splendida    0.6545883 0.6532237 0.28855528 0.4100487
#&gt;                               y          z
#&gt; Goodenia_heterophylla 0.2890630 0.41888569
#&gt; Goodenia_geniculata   0.3878295 0.24367620
#&gt; Goodenia_gracilis     0.4659473 0.01789065
#&gt; Xyris_operculata      0.3148309 0.29965743
#&gt; Eucalyptus_sp         0.3462699 0.31122295
#&gt; Faradaya_splendida    0.4091939 0.18075745</code></pre>
<p>The output is simply the tristimulus values and chromaticity coordinates of stimuli, and we can visualise our results (along with a line connecting monochromatic loci, by default) by calling</p>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ciexyz.flowers</span>, pch <span class="op">=</span> <span class="fl">21</span>, bg <span class="op">=</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/spec2rgb.html">spec2rgb</a></span><span class="op">(</span><span class="va">flowers</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-98"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-98-1.png" alt="Floral reflectance in the CIEXYZ human visual model. Note that this space is not perceptually calibrated, so we cannot make inferences about the similarity or differences of colours based on their relative location." width="480"><p class="caption">
Figure 3.14: Floral reflectance in the CIEXYZ human visual model. Note that this space is not perceptually calibrated, so we cannot make inferences about the similarity or differences of colours based on their relative location.
</p>
</div>
<p>The <code>Lab</code> space is a more recent development, and is a colour-opponent model that attempts to mimic the nonlinear responses of the human eye. The <code>Lab</code> space is also calibrated (unlike the <code>XYZ</code> space) such that Euclidean distances between points represent relative perceptual distances. This means that two stimuli that are farther apart in <code>Lab</code> space should be <em>perceived</em> as more different than two closer points. As the name suggests, the dimensions of the <code>Lab</code> space are <em>L</em>ightness (i.e. subjective brightness), along with two colour-opponent dimensions designated <em>a</em> and <em>b</em>. The <code><a href="http://pavo.colrverse.com/reference/colspace.html">colspace()</a></code> function, when <code>space = cielab</code>, simply converts points from the <code>XYZ</code> model according to:</p>
$$
<span class="math display">\[\begin{split}

L &amp;=\begin{cases}
116\left(\frac{Y}{Y_n}\right)^\frac{1}{3} &amp; \text{if } \frac{Y}{Y_n} &gt; 0.008856 \\
903.3\left(\frac{Y}{Y_n}\right) &amp; \text{if } \frac{Y}{Y_n} \leq 0.008856
\end{cases}\\

a &amp;= 500\left(f\left(\frac{X}{X_n}\right) - f\left(\frac{Y}{Y_n}\right)\right)\\

b &amp;= 500\left(f\left(\frac{Y}{Y_n}\right) - f\left(\frac{Z}{Z_n}\right)\right)

\end{split}\]</span>
<p>$$</p>
<p>where</p>
<p><span class="math display">\[
f(x)=\begin{cases}
x^\frac{1}{3} &amp; \text{if } x &gt; 0.008856 \\
7.787x + \frac{4}{29} &amp; \text{if } x \leq 0.008856
\end{cases}
\]</span></p>
<p>Here, <span class="math inline">\(X_n, Y_n, Z_n\)</span> are neutral point values to model visual adaptation, calculated as:</p>
<p><span class="math display">\[
\begin{split}
X_n &amp;= \int_{300}^{700}{R_n(\lambda)I(\lambda)\bar{x}(\lambda)\,d\lambda}\\
Y_n &amp;= \int_{300}^{700}{R_n(\lambda)I(\lambda)\bar{y}(\lambda)\,d\lambda}\\
Z_n &amp;= \int_{300}^{700}{R_n(\lambda)I(\lambda)\bar{z}(\lambda)\,d\lambda}
\end{split}
\]</span></p>
<p>when <span class="math inline">\(R_n(\lambda)\)</span> is a perfect diffuse reflector (i.e. 1).</p>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cielab.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="va">vis.flowers</span>, space <span class="op">=</span> <span class="st">"cielab"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cielab.flowers</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;                               X         Y          Z        L
#&gt; Goodenia_heterophylla 0.2095846 0.2074402 0.30060475 16.75107
#&gt; Goodenia_geniculata   0.6415362 0.6751982 0.42423209 54.52316
#&gt; Goodenia_gracilis     0.5027874 0.4538738 0.01742707 36.65092
#&gt; Xyris_operculata      0.2847275 0.2325247 0.22131809 18.77668
#&gt; Eucalyptus_sp         0.4421178 0.4469747 0.40173521 36.09381
#&gt; Faradaya_splendida    0.6545883 0.6532237 0.28855528 52.74869
#&gt;                               a          b
#&gt; Goodenia_heterophylla  3.110872 -18.616834
#&gt; Goodenia_geniculata   -4.478971  26.973109
#&gt; Goodenia_gracilis     22.697331  60.437370
#&gt; Xyris_operculata      21.382120  -2.596506
#&gt; Eucalyptus_sp          3.297259  -1.246816
#&gt; Faradaya_splendida     7.859790  45.351679</code></pre>
<p>Our output now contains the tristimulus <code>XYZ</code> values, as well as their <code>Lab</code> counterparts, which are coordinates in the <code>Lab</code> space. These can also be visualised in three-dimensional <code>Lab</code> space by calling <code>plot</code>:</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cielab.flowers</span>, pch <span class="op">=</span> <span class="fl">21</span>, bg <span class="op">=</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/spec2rgb.html">spec2rgb</a></span><span class="op">(</span><span class="va">flowers</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-100"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-100-1.png" alt="Floral reflectance spectra represented in the CIELab model of human colour sensation." width="480"><p class="caption">
Figure 3.15: Floral reflectance spectra represented in the CIELab model of human colour sensation.
</p>
</div>
</div>
<div id="categorical-fly-colourspace" class="section level5" number="3.1.4.6.5">
<h5>
<span class="header-section-number">3.1.4.6.5</span> Categorical Fly Colourspace<a class="anchor" aria-label="anchor" href="#categorical-fly-colourspace"><i class="fas fa-link"></i></a>
</h5>
<p>The categorical colour vision model of <span class="citation">Troje (<a href="references.html#ref-Troje1993">1993</a>)</span> is a model of dipteran vision, based on behavioural data from the blowfly <em>Lucilia</em> sp. It assumes the involvement of all four dipteran photoreceptor classes (R7 &amp; R8 ‘pale’ and ‘yellow’ subtypes), and further posits that colour vision is based on two specific opponent mechanisms (R7p - R8p, and R7y - R8y). The model assumes that all colours are perceptually grouped into one of four colour categories, and that flies are unable to distinguish between colours that fall within the same category.</p>
<p>We’ll use the visual systems of the muscoid fly <em>Musca domestica</em>, and will begin by estimating linear (i.e. untransformed) quantum catches for each of the four photoreceptors.</p>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vis.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">flowers</span>,</span>
<span>  qcatch <span class="op">=</span> <span class="st">"Qi"</span>,</span>
<span>  visual <span class="op">=</span> <span class="st">"musca"</span>,</span>
<span>  achromatic <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  relative <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Our call to <code><a href="http://pavo.colrverse.com/reference/colspace.html">colspace()</a></code> will then simply estimate the location of stimuli in the categorical space as the difference in relative stimulation between ‘pale’ (R7p - R8p) and ‘yellow’ (R7y - R8y) photoreceptor pairs:</p>
<p><span class="math display">\[
\begin{split}
x &amp;= R7_p - R8_p\\
y &amp;= R7_y - R8_y
\end{split}
\]</span></p>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cat.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="va">vis.flowers</span>, space <span class="op">=</span> <span class="st">"categorical"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cat.flowers</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;                              R7p        R7y       R8p       R8y
#&gt; Goodenia_heterophylla 0.05387616 0.18710662 0.4335986 0.3254187
#&gt; Goodenia_geniculata   0.02080098 0.08276030 0.3737592 0.5226795
#&gt; Goodenia_gracilis     0.01153130 0.02501417 0.1420049 0.8214496
#&gt; Xyris_operculata      0.01270353 0.12523419 0.4488377 0.4132246
#&gt; Eucalyptus_sp         0.03461949 0.14207848 0.3977208 0.4255812
#&gt; Faradaya_splendida    0.03599953 0.09188560 0.3129195 0.5591953
#&gt;                                x          y category     r.vec
#&gt; Goodenia_heterophylla -0.3797224 -0.1383120     p-y- 0.4041279
#&gt; Goodenia_geniculata   -0.3529583 -0.4399192     p-y- 0.5640110
#&gt; Goodenia_gracilis     -0.1304736 -0.7964355     p-y- 0.8070519
#&gt; Xyris_operculata      -0.4361342 -0.2879904     p-y- 0.5226390
#&gt; Eucalyptus_sp         -0.3631013 -0.2835027     p-y- 0.4606695
#&gt; Faradaya_splendida    -0.2769200 -0.4673097     p-y- 0.5431971
#&gt;                         h.theta lum
#&gt; Goodenia_heterophylla -2.792284  NA
#&gt; Goodenia_geniculata   -2.246954  NA
#&gt; Goodenia_gracilis     -1.733176  NA
#&gt; Xyris_operculata      -2.557993  NA
#&gt; Eucalyptus_sp         -2.478681  NA
#&gt; Faradaya_splendida    -2.105745  NA</code></pre>
<p>And it is simply the signs of these differences that define the four possible fly-colour categories (p+y+, p-y+, p+y-, p-y-), which we can see in the associated plot.</p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cat.flowers</span>, pch <span class="op">=</span> <span class="fl">21</span>, bg <span class="op">=</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/spec2rgb.html">spec2rgb</a></span><span class="op">(</span><span class="va">flowers</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-103"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-103-1.png" alt="Flowers in the categorical colourspace of Troje (1993)." width="480"><p class="caption">
Figure 3.16: Flowers in the categorical colourspace of Troje (1993).
</p>
</div>
</div>
<div id="segment-classification" class="section level5" number="3.1.4.6.6">
<h5>
<span class="header-section-number">3.1.4.6.6</span> Segment Classification<a class="anchor" aria-label="anchor" href="#segment-classification"><i class="fas fa-link"></i></a>
</h5>
<p>The segment classification analysis <span class="citation">(<a href="references.html#ref-Endler1990">Endler 1990</a>)</span> does not assume any particular visual system, but instead tries to classify colours in a manner that captures common properties of many vertebrate (and some invertebrate) visual systems. In essence, it breaks down the reflectance spectrum region of interest into four equally-spaced regions, measuring the relative signal along those regions. This approximates a tetrachromatic system with ultraviolet, short, medium, and long-wavelength sensitive photoreceptors.</p>
<p>Though somewhat simplistic, this model captures many of the properties of other, more complex visual models, but without many of the additional assumptions these make. It also provides results in a fairly intuitive colour space, in which the angle corresponds to hue and the distance from the centre corresponds to chroma (Figure below; in fact, variables <code>S5</code> and <code>H4</code> from <code>summary.rspec()</code> are calculated from these relative segments).
Note that, while a segment analysis ranging from 300 or 400 nm to 700 nm corresponds quite closely to the human visual system colour wheel, any wavelength range can be analysed in this way, returning a 360° hue space delimited by the range used.</p>
<p>The segment differences or “opponents” are calculated as:</p>
<p><span class="math display">\[
\begin{split}
LM &amp;= \frac{ R_\lambda \sum_{\lambda={Q4}} R_\lambda - \sum_{\lambda={Q2}} R_\lambda }{\sum_{\lambda={min}}^{max}R_\lambda}\\
MS &amp;= \frac{ R_\lambda \sum_{\lambda={Q3}} R_\lambda - \sum_{\lambda={Q1}} R_\lambda }{\sum_{\lambda={min}}^{max}R_\lambda}
\end{split}
\]</span></p>
<p>Where <span class="math inline">\(Qi\)</span> represent the interquantile distances (e.g. <span class="math inline">\(Q1=ultraviolet\)</span>, <span class="math inline">\(Q2=blue\)</span>, <span class="math inline">\(Q3=green\)</span> and <span class="math inline">\(Q4=red\)</span>)</p>
<p>The segment classification model is obtained through the <code><a href="http://pavo.colrverse.com/reference/colspace.html">colspace()</a></code> argument <code>space = 'segment'</code>, following initial modelling with <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code>. The example below uses idealized reflectance spectra to illustrate how the avian colour space defined from the segment classification maps to the human colour wheel:</p>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fakedata1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span>, by <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">300</span><span class="op">:</span><span class="fl">700</span>, <span class="va">x</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">300</span><span class="op">:</span><span class="fl">700</span>, <span class="va">x</span> <span class="op">+</span> <span class="fl">400</span>, <span class="fl">30</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">401</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># creating idealized specs with varying saturation</span></span>
<span><span class="va">fakedata2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">300</span>, <span class="fl">150</span>, <span class="fl">105</span>, <span class="fl">75</span>, <span class="fl">55</span>, <span class="fl">40</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">300</span><span class="op">:</span><span class="fl">700</span>, <span class="fl">550</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">401</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fakedata1</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/as.rspec.html">as.rspec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>wl <span class="op">=</span> <span class="fl">300</span><span class="op">:</span><span class="fl">700</span>, <span class="va">fakedata1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; wavelengths found in column 1</code></pre>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fakedata1</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/procspec.html">procspec</a></span><span class="op">(</span><span class="va">fakedata1</span>, <span class="st">"max"</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; processing options applied:
#&gt; Scaling spectra to a maximum value of 1</code></pre>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fakedata2</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/as.rspec.html">as.rspec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>wl <span class="op">=</span> <span class="fl">300</span><span class="op">:</span><span class="fl">700</span>, <span class="va">fakedata2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; wavelengths found in column 1</code></pre>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fakedata2</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/procspec.html">procspec</a></span><span class="op">(</span><span class="va">fakedata2</span>, <span class="st">"sum"</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; processing options applied:
#&gt; Scaling spectra to a total area of 1</code></pre>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fakedata2</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/procspec.html">procspec</a></span><span class="op">(</span><span class="va">fakedata2</span>, <span class="st">"min"</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; processing options applied:
#&gt; Scaling spectra to a minimum value of zero</code></pre>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># converting reflectance to percentage</span></span>
<span><span class="va">fakedata1</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fakedata1</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="va">fakedata2</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fakedata2</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">fakedata2</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span></span>
<span><span class="co"># combining and converting to rspec</span></span>
<span><span class="va">fakedata.c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  wl <span class="op">=</span> <span class="fl">300</span><span class="op">:</span><span class="fl">700</span>,</span>
<span>  <span class="va">fakedata1</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="va">fakedata2</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fakedata.c</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/as.rspec.html">as.rspec</a></span><span class="op">(</span><span class="va">fakedata.c</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; wavelengths found in column 1</code></pre>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># segment classification analysis</span></span>
<span><span class="va">seg.vis</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">fakedata.c</span>,</span>
<span>  visual <span class="op">=</span> <span class="st">"segment"</span>,</span>
<span>  achromatic <span class="op">=</span> <span class="st">"all"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">seg.fdc</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="va">seg.vis</span>, space <span class="op">=</span> <span class="st">"segment"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">seg.fdc</span>, col <span class="op">=</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/spec2rgb.html">spec2rgb</a></span><span class="op">(</span><span class="va">fakedata.c</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-104"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-104-1.png" alt="Idealized reflectance spectra and their projection on the axes of segment classification" width="480"><p class="caption">
Figure 3.17: Idealized reflectance spectra and their projection on the axes of segment classification
</p>
</div>
</div>
<div id="colourspace-distances-with-coldist" class="section level5" number="3.1.4.6.7">
<h5>
<span class="header-section-number">3.1.4.6.7</span> Colourspace Distances with <code>coldist</code><a class="anchor" aria-label="anchor" href="#colourspace-distances-with-coldist"><i class="fas fa-link"></i></a>
</h5>
<p>Under the colourspace framework, colour distances can be calculated simply as Euclidean distances of the relative cone stimulation data, either log-transformed or not, depending on how it was defined. Euclidean distances can be computed in <code>R</code> using the <code><a href="http://pavo.colrverse.com/reference/coldist.html">coldist()</a></code> function on the <code><a href="http://pavo.colrverse.com/reference/colspace.html">colspace()</a></code> output:</p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="http://pavo.colrverse.com/reference/coldist.html">coldist</a></span><span class="op">(</span><span class="va">tetra.flowers</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; Quantum catch are relative, distances may not be meaningful</code></pre>
<pre class="cm"><code>#&gt; Calculating unweighted Euclidean distances</code></pre>
<pre><code>#&gt;                  patch1              patch2         dS dL
#&gt; 1 Goodenia_heterophylla Goodenia_geniculata 0.06695922 NA
#&gt; 2 Goodenia_heterophylla   Goodenia_gracilis 0.20467411 NA
#&gt; 3 Goodenia_heterophylla    Xyris_operculata 0.05407934 NA
#&gt; 4 Goodenia_heterophylla       Eucalyptus_sp 0.01901724 NA
#&gt; 5 Goodenia_heterophylla  Faradaya_splendida 0.05027645 NA
#&gt; 6 Goodenia_heterophylla  Gaultheria_hispida 0.03897671 NA</code></pre>
<p>Specialised colourspace models such as the colour-hexagon, coc space, CIELab and CIELCh models have their own distance measures, which are returned be default when run through <code><a href="http://pavo.colrverse.com/reference/coldist.html">coldist()</a></code>. Be sure to read the <code><a href="http://pavo.colrverse.com/reference/coldist.html">?coldist</a></code> documentation, and the original publications, to understand what is being returned. As an example, if we run the results of colour-hexagon modelling through <code><a href="http://pavo.colrverse.com/reference/coldist.html">coldist()</a></code>:</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model flower colours according to a honeybee</span></span>
<span><span class="va">vis.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">flowers</span>,</span>
<span>  visual <span class="op">=</span> <span class="st">"apis"</span>,</span>
<span>  qcatch <span class="op">=</span> <span class="st">"Ei"</span>,</span>
<span>  relative <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  vonkries <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  achromatic <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>  bkg <span class="op">=</span> <span class="st">"green"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">hex.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/colspace.html">colspace</a></span><span class="op">(</span><span class="va">vis.flowers</span>, space <span class="op">=</span> <span class="st">"hexagon"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate colour distances. No need to specify</span></span>
<span><span class="co"># relative receptor densities, noise etc., which</span></span>
<span><span class="co"># only apply in the case of receptor-noise modelling</span></span>
<span><span class="va">dist.flowers</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/coldist.html">coldist</a></span><span class="op">(</span><span class="va">hex.flowers</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; Calculating unweighted Euclidean distances</code></pre>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">dist.flowers</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;                  patch1              patch2        dS dL
#&gt; 1 Goodenia_heterophylla Goodenia_geniculata 0.3207265 NA
#&gt; 2 Goodenia_heterophylla   Goodenia_gracilis 0.6870945 NA
#&gt; 3 Goodenia_heterophylla    Xyris_operculata 0.3025298 NA
#&gt; 4 Goodenia_heterophylla       Eucalyptus_sp 0.1111375 NA
#&gt; 5 Goodenia_heterophylla  Faradaya_splendida 0.2324927 NA
#&gt; 6 Goodenia_heterophylla  Gaultheria_hispida 0.2280836 NA</code></pre>
<p>the chromatic contrasts <code>dS</code> and achromatic contrasts <code>dL</code> are expressed as Euclidean distances in the hexagon, known as ‘hexagon units’ <span class="citation">(<a href="references.html#ref-Chittka1992">Chittka 1992</a>)</span>. If we had instead used the colour-opponent coding space the units would have been city-bloc distances, while in the CIELab model the distances would be derived from the CIE colour-distance formula (2000).</p>
</div>
<div id="distances-in-n-dimensions" class="section level5" number="3.1.4.6.8">
<h5>
<span class="header-section-number">3.1.4.6.8</span> Distances in N-Dimensions<a class="anchor" aria-label="anchor" href="#distances-in-n-dimensions"><i class="fas fa-link"></i></a>
</h5>
<p>The <code><a href="http://pavo.colrverse.com/reference/coldist.html">coldist()</a></code> function is no longer limited to di-, tri- or tetrachromatic visual systems. The function has been generalised, and can now calculate colour distances for n-dimensional visual phenotypes. This means there is no limit on the dimensionality of visual systems that may be input, which may prove useful for modelling nature’s extremes (e.g. butterflies, mantis shrimp) or for simulation-based work. Naturally, since these calculations aren’t largely implemented elsewhere, we recommend caution and validation of results prior to publication.</p>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create an arbitrary visual phenotype with 10 photoreceptors</span></span>
<span><span class="va">fakemantisshrimp</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/sensmodel.html">sensmodel</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">325</span>, <span class="fl">350</span>, <span class="fl">400</span>,</span>
<span>    <span class="fl">425</span>, <span class="fl">450</span>, <span class="fl">500</span>,</span>
<span>    <span class="fl">550</span>, <span class="fl">600</span>, <span class="fl">650</span>,</span>
<span>    <span class="fl">700</span></span>
<span>  <span class="op">)</span>,</span>
<span>  beta <span class="op">=</span> <span class="cn">FALSE</span>, integrate <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to percentages, just to colour the plot</span></span>
<span><span class="va">fakemantisshrimp.colours</span> <span class="op">&lt;-</span> <span class="va">fakemantisshrimp</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="va">fakemantisshrimp.colours</span><span class="op">[</span>, <span class="st">"wl"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fakemantisshrimp</span><span class="op">[</span>, <span class="st">"wl"</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fakemantisshrimp</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/spec2rgb.html">spec2rgb</a></span><span class="op">(</span><span class="va">fakemantisshrimp.colours</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Absorbance"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-107"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-107-1.png" alt="Visual system of a pretend mantis shrimp with 10 cones" width="480"><p class="caption">
Figure 3.18: Visual system of a pretend mantis shrimp with 10 cones
</p>
</div>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run visual model and calculate colour distances</span></span>
<span><span class="va">vm.fms</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">flowers</span>,</span>
<span>  visual <span class="op">=</span> <span class="va">fakemantisshrimp</span>,</span>
<span>  relative <span class="op">=</span> <span class="cn">FALSE</span>, achromatic <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">JND.fms</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/coldist.html">coldist</a></span><span class="op">(</span><span class="va">vm.fms</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; Calculating noise-weighted Euclidean distances</code></pre>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">JND.fms</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;                  patch1              patch2        dS dL
#&gt; 1 Goodenia_heterophylla Goodenia_geniculata 16.297557 NA
#&gt; 2 Goodenia_heterophylla   Goodenia_gracilis 48.390309 NA
#&gt; 3 Goodenia_heterophylla    Xyris_operculata 30.760482 NA
#&gt; 4 Goodenia_heterophylla       Eucalyptus_sp  6.044184 NA
#&gt; 5 Goodenia_heterophylla  Faradaya_splendida 15.901435 NA
#&gt; 6 Goodenia_heterophylla  Gaultheria_hispida 11.188246 NA</code></pre>
</div>
</div>
</div>
</div>
<div id="analysing-spatial-data" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> Analysing Spatial Data<a class="anchor" aria-label="anchor" href="#analysing-spatial-data"><i class="fas fa-link"></i></a>
</h2>
<p><code>pavo</code> now allows for the combined analysis of spectral data and spatial data. Note that ‘spatial’ data of course include images, but may also draw on spatially-sampled <em>spectra</em>, as explored below. Thus while much of the below deals with image-based processing and analysis, images are not necessary for many spatial analyses and indeed may perform worse than spectrally-based analyses in some cases. Further, <strong>image data should seldom be used without input from spectral measurements</strong>. Even in the simple butterfly example below, users should first validate the presence and number of discrete colours in a patch via spectral measurement and visual modelling (i.e. the ‘spectral’ information), which is then augmented by image-based clustering of these <em>a priori</em> identified patches to extract the ‘spatial’ information. Using uncalibrated images alone for inferences about colour pattern perception may well yield unreliable results, given the radical differences between human (camera) and non-human animal perception.</p>
<div id="image-based-colour-classification" class="section level3" number="3.2.1">
<h3>
<span class="header-section-number">3.2.1</span> Image-based colour classification<a class="anchor" aria-label="anchor" href="#image-based-colour-classification"><i class="fas fa-link"></i></a>
</h3>
<p>We first import our images with <code><a href="http://pavo.colrverse.com/reference/getimg.html">getimg()</a></code>, which functions in a similar manner to <code><a href="http://pavo.colrverse.com/reference/getspec.html">getspec()</a></code>. Since we are importing more than one image, we can simply point the function to the folder containing the images, and it will use parallel processing (where possible) to import any jpg, bmp, or png images in the folder. As with the raw spectra, these images are also available at the package repository [here][data-location], but are included in the package installation for convenience.</p>
<div class="sourceCode" id="cb236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">butterflies</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/getimg.html">getimg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"testdata/images/butterflies"</span>, package <span class="op">=</span> <span class="st">"pavo"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; 2 files found; importing images.</code></pre>
<p>The segmentation of RGB images into discrete colour-classes is an useful step on the road to several analyses, and this is carried out in <code>pavo</code> via <code><a href="http://pavo.colrverse.com/reference/classify.html">classify()</a></code>. The function currently implements k-means clustering which, and offers some flexibility in the way in which it is carried out. In the simplest case, we can specify an image or image(s) as well as the number of discrete colours in each, and allow the k-means clustering algorithm to do its work. <strong>Note that the specification of <em>k</em>, the number of discrete colours in an image, is a crucial step to be estimated <em>a priori</em> beforehand</strong>, typically through the use of visual modelling to estimate the number of discriminable colours in an ‘objective’ manner. There are a suite of possible ways in which this may be achieved, though, with one detailed below as part of example 2.</p>
<p>Since we have two images, with (arguably) four and three colours each, including the white background, we can specify this information using <code>kcols</code>, before visualising the results with <code>summary</code>. The <code>summary</code> function, with <code>plot = TRUE</code>, is also particularly useful for understanding the colour-class labels, or ID’s, assigned to each colour, as well as visualising the accuracy of the classification process, which may be enhanced by specifying strongly-contrasting ‘false’ colours for plotting through the <code>col</code> argument.</p>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">butterflies_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/classify.html">classify</a></span><span class="op">(</span><span class="va">butterflies</span>, kcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; Image classification in progress...</code></pre>
<div class="sourceCode" id="cb240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note that we could simply feed the list of</span></span>
<span><span class="co"># images to summary, rather than specifying</span></span>
<span><span class="co"># individual images, and they would progress</span></span>
<span><span class="co"># automatically with user input.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">butterflies_class</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-110"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-110-1.png" alt="The k-means classified images of our butterflies, along with their identified colour palettes" width="576"><p class="caption">
Figure 3.19: The k-means classified images of our butterflies, along with their identified colour palettes
</p>
</div>
<p>There are other options available, which may be of particular use when the classification process is not producing the results that might be expected. If analysing similar images with homologous colour patterns (e.g. individuals within a species), we could specify a single ‘reference’ image in a list to be initially classified, using <code>refID</code>, with the RGB centres identified in this reference image used as pre-specified cluster centres in subsequent images. This helps to ensure that homologous pattern elements are reliably identified and classified between images. The <code><a href="http://pavo.colrverse.com/reference/classify.html">classify()</a></code> function also offers an interactive option, via <code>interactive = TRUE</code>, wherein we can interactively click on representative colours within an image (or images individually), with the RGB values then used as cluster centres. This is particularly useful when images are being erroneously classified, since the standard k-means process randomly selects initial centres and so may (by chance) miss smaller patches, or confuse similar colours. By specifying the initial RGB centres interactively, it can be easier for the process to distinguish or ‘pull apart’ colours in such circumstances. Ultimately, there are several combinations of options available during classification, which are also documented in the help file. For our butterflies, for example, we could use any of the following (though some would be very ill-advised):</p>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Automatic classification.</span></span>
<span><span class="va">butterflies_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/classify.html">classify</a></span><span class="op">(</span><span class="va">butterflies</span>, kcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; Image classification in progress...</code></pre>
<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Automatic classification using a reference image,</span></span>
<span><span class="co"># identified by name.</span></span>
<span><span class="va">butterflies_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/classify.html">classify</a></span><span class="op">(</span><span class="va">butterflies</span>,</span>
<span>  refID <span class="op">=</span> <span class="st">"h_melpomene"</span>,</span>
<span>  kcols <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; Image classification in progress...</code></pre>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Classification using interactively-specified centres for each image, with no</span></span>
<span><span class="co"># need to specify kcols (since it will be inferred from the numbers of colours selected)</span></span>
<span><span class="va">butterflies_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/classify.html">classify</a></span><span class="op">(</span><span class="va">butterflies</span>, interactive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Classification using interactively-specified centres</span></span>
<span><span class="co"># for the single reference image (here, the first in</span></span>
<span><span class="co"># the list). We could also specify reference image</span></span>
<span><span class="co"># using it's name, as above.</span></span>
<span><span class="va">butterflies_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/classify.html">classify</a></span><span class="op">(</span><span class="va">butterflies</span>,</span>
<span>  refID <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  interactive <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div id="adjacency-and-boundary-strength-analyses-and-overall-pattern-contrasts" class="section level3" number="3.2.2">
<h3>
<span class="header-section-number">3.2.2</span> Adjacency and Boundary Strength Analyses, and Overall Pattern Contrasts<a class="anchor" aria-label="anchor" href="#adjacency-and-boundary-strength-analyses-and-overall-pattern-contrasts"><i class="fas fa-link"></i></a>
</h3>
<p>The adjacency <span class="citation">(<a href="references.html#ref-Endler2012">Endler 2012</a>)</span> and boundary strength <span class="citation">(<a href="references.html#ref-Endler2018">Endler, Cole, and Kranz 2018</a>)</span> analyses offer a powerful method for quantifying various features of colour pattern geometry. Briefly, the process entails classifying grid-sampled locations within a visual scene into a number of discrete colour classes. This may be achieved using <code><a href="http://pavo.colrverse.com/reference/classify.html">classify()</a></code> as described above before sampling the now-classified image, and/or by taking grid-sampled reflectance spectra across a visual scene, visually modelling and clustering the results <span class="citation">(as per ‘method 1’ in <a href="references.html#ref-Endler2012">Endler 2012</a>, example below)</span>. The column-wise and row-wise colour-class transitions between adjacent points within this grid are then tallied, and from this a suite of summary statistics on pattern structure — from simple colour proportions, through to colour diversity and pattern complexity — are estimated. If the colour ‘distance’ between adjacent colour classes is known, such as might be estimated using spectral data for receptor-noise modelling via <code><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel()</a></code> and <code><a href="http://pavo.colrverse.com/reference/coldist.html">coldist()</a></code>, then this can also be incorporated to derive several measures of the salience of patch boundaries <span class="citation">(<a href="references.html#ref-Endler2018">Endler, Cole, and Kranz 2018</a>)</span>. Finally, if estimates of hue, saturation, and/or brightness are known for each discrete colour in a pattern, then these can be included through the <code>hsl</code> argument for general, area-weighted measures of overall pattern contrast <span class="citation">(<a href="references.html#ref-Endler2005">Endler and Mielke 2005</a>)</span>. In <code>pavo</code>, this is all carried out through the <code><a href="http://pavo.colrverse.com/reference/adjacent.html">adjacent()</a></code> function, which takes several arguments that should be well understood.</p>
<div id="example-1-simple-mounted-butterflies" class="section level4" number="3.2.2.1">
<h4>
<span class="header-section-number">3.2.2.1</span> Example 1 (simple): mounted butterflies<a class="anchor" aria-label="anchor" href="#example-1-simple-mounted-butterflies"><i class="fas fa-link"></i></a>
</h4>
<p>We’ll begin with a simple example using mounted butterflies, by first loading and classifying our images in the manner outlined above. For the adjacency analysis proper, we’ll specify a full x-dimension scale of 200 mm using <code>xscale</code> (which could be ignored if we specify scales using <code><a href="http://pavo.colrverse.com/reference/procimg.html">procimg()</a></code>), and a sampling density of 200, for a 200 x 200 grid. Since the white background of our images is fake and of no interest, we will also exclude it by specifying the colour-class ID that corresponds to it (for more complex backgrounds, we could instead use <code><a href="http://pavo.colrverse.com/reference/procimg.html">procimg()</a></code>, as above, and ignore this argument).</p>
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load up our images</span></span>
<span><span class="va">butterflies</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/getimg.html">getimg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"testdata/images/butterflies"</span>, package <span class="op">=</span> <span class="st">"pavo"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; 2 files found; importing images.</code></pre>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Automatically classify discrete colour patches (as confirmed</span></span>
<span><span class="co"># by spectral modelling) using k-means clustering, with values</span></span>
<span><span class="co"># of 'k' that have been validated a priori.</span></span>
<span><span class="va">butterflies_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/classify.html">classify</a></span><span class="op">(</span><span class="va">butterflies</span>, kcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; Image classification in progress...</code></pre>
<div class="sourceCode" id="cb250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the adjacency analysis, subsampling the image in a</span></span>
<span><span class="co"># 200x200 grid, and excluding the white background.</span></span>
<span><span class="va">butterflies_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/adjacent.html">adjacent</a></span><span class="op">(</span><span class="va">butterflies_class</span>,</span>
<span>  xscale <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  xpts <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  bkgID <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Take a look</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">butterflies_adj</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;             k     N n_off        p_1       p_2       p_3      p_4
#&gt; h_melpomene 4 54064  5111 0.03511029 0.5833824 0.3408824 0.040625
#&gt; papilio     3 63241  3883 0.16220126 0.6441824 0.1936164       NA
#&gt;                   q_1_1      q_1_2     q_2_2      q_1_3      q_2_3
#&gt; h_melpomene 0.006510802 0.01294762 0.5649970 0.03486608 0.01864457
#&gt; papilio     0.138059170 0.00713145 0.6329596 0.04299426 0.01127433
#&gt;                 q_3_3       q_1_4      q_3_4      q_4_4     t_1_2
#&gt; h_melpomene 0.3071175 0.009821693 0.01825614 0.02683856 0.1369595
#&gt; papilio     0.1675812          NA         NA         NA 0.1161473
#&gt;                 t_1_3     t_2_3     t_1_4     t_3_4          m
#&gt; h_melpomene 0.3688124 0.1972217 0.1038936 0.1931129 0.09395221
#&gt; papilio     0.7002318 0.1836209        NA        NA 0.06102033
#&gt;                    m_r       m_c         A       Sc       St
#&gt; h_melpomene 0.08779412 0.1001103 0.8769739 2.176663 4.136277
#&gt; papilio     0.06937107 0.0526696 1.3170989 2.088697 1.860357
#&gt;                    Jc        Jt         B        Rt Rab m_dS s_dS
#&gt; h_melpomene 0.5441657 0.6893795 0.4558795 0.4803734   1   NA   NA
#&gt; papilio     0.6962322 0.6201188 0.2191604 0.5375314   1   NA   NA
#&gt;             cv_dS m_dL s_dL cv_dL m_hue s_hue var_hue m_sat s_sat
#&gt; h_melpomene    NA   NA   NA    NA    NA    NA      NA    NA    NA
#&gt; papilio        NA   NA   NA    NA    NA    NA      NA    NA    NA
#&gt;             cv_sat m_lum s_lum cv_lum
#&gt; h_melpomene     NA    NA    NA     NA
#&gt; papilio         NA    NA    NA     NA</code></pre>
<p>The output is a suite of statistics describing colour pattern structure and geometry in a tidy data frame that, since we fed it a list of images, contains one row for each of our samples. As always, the function’s help file (<code><a href="http://pavo.colrverse.com/reference/adjacent.html">?adjacent</a></code>) summarises the meaning of each output variable, and the original references listed therein contain the full discussion. Note that some of the output is <code>NA</code>, which might occur when the focal statistic simply makes no sense for the image in question (such as the transition frequency between colour categories 3 and 4, for an image that contains only 3 colour categories). Others may result when we do not give <code><a href="http://pavo.colrverse.com/reference/adjacent.html">adjacent()</a></code> enough information, such as the colour-distances required to calculate the boundary-strength statistics, or the colourmetrics required for overall pattern contrast. If we do give the function this information, we can see that those final variables now contain sensible output.</p>
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a fake matrix of pairwise colour- and luminance</span></span>
<span><span class="co"># distances between all colour patten elements, as might</span></span>
<span><span class="co"># be attained through visual modelling of spectral data.</span></span>
<span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  c1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  c2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  dS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10.6</span>, <span class="fl">5.1</span>, <span class="fl">4.4</span><span class="op">)</span>,</span>
<span>  dL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">2.5</span>, <span class="fl">3.2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Take a look</span></span>
<span><span class="va">distances</span></span></code></pre></div>
<pre><code>#&gt;   c1 c2   dS  dL
#&gt; 1  1  2 10.6 1.1
#&gt; 2  1  3  5.1 2.5
#&gt; 3  2  3  4.4 3.2</code></pre>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># And our fake hue angles (in radians), saturation,</span></span>
<span><span class="co"># and luminance values, for each colour pattern element</span></span>
<span><span class="va">hsl_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  patch <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>  hue <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">2.2</span>, <span class="fl">1.6</span><span class="op">)</span>,</span>
<span>  lum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span>,</span>
<span>  sat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.5</span>, <span class="fl">1.1</span>, <span class="fl">6.3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Take a look</span></span>
<span><span class="va">hsl_vals</span></span></code></pre></div>
<pre><code>#&gt;   patch hue lum sat
#&gt; 1     1 1.2  10 3.5
#&gt; 2     2 2.2   5 1.1
#&gt; 3     3 1.6   7 6.3</code></pre>
<div class="sourceCode" id="cb256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now feed this information into the adjacency analysis</span></span>
<span><span class="co"># using the 'less-colourful' of our two images, for convenience</span></span>
<span><span class="co"># (though this could be readily extended to include a list</span></span>
<span><span class="co"># of images along with a list of distances and hsl values)</span></span>
<span><span class="fu"><a href="http://pavo.colrverse.com/reference/adjacent.html">adjacent</a></span><span class="op">(</span><span class="va">butterflies_class</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  xscale <span class="op">=</span> <span class="fl">200</span>, xpts <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  bkgID <span class="op">=</span> <span class="fl">1</span>, coldists <span class="op">=</span> <span class="va">distances</span>, hsl <span class="op">=</span> <span class="va">hsl_vals</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;         k     N n_off       p_1       p_2       p_3     q_1_1
#&gt; papilio 3 63241  3883 0.1622013 0.6441824 0.1936164 0.1380592
#&gt;              q_1_2     q_2_2      q_1_3      q_2_3     q_3_3
#&gt; papilio 0.00713145 0.6329596 0.04299426 0.01127433 0.1675812
#&gt;             t_1_2     t_1_3     t_2_3          m        m_r
#&gt; papilio 0.1161473 0.7002318 0.1836209 0.06102033 0.06937107
#&gt;               m_c        A       Sc       St        Jc        Jt
#&gt; papilio 0.0526696 1.317099 2.088697 1.860357 0.6962322 0.6201188
#&gt;                 B        Rt Rab     m_dS     s_dS     cv_dS
#&gt; papilio 0.2191604 0.5375314   1 5.610276 2.688625 0.4792323
#&gt;             m_dL      s_dL     cv_dL    m_hue     s_hue   var_hue
#&gt; papilio 2.465928 0.8272175 0.3354589 1.663715 0.4154308 0.0826731
#&gt;            m_sat    s_sat   cv_sat    m_lum    s_lum    cv_lum
#&gt; papilio 2.496088 2.845585 1.140018 6.198239 2.551657 0.4116745</code></pre>
</div>
<div id="example-2-complex-whole-visual-environments" class="section level4" number="3.2.2.2">
<h4>
<span class="header-section-number">3.2.2.2</span> Example 2 (complex): whole visual environments<a class="anchor" aria-label="anchor" href="#example-2-complex-whole-visual-environments"><i class="fas fa-link"></i></a>
</h4>
<p>Of course colour patterns are not always so simple, and we may want to analyse the spatial geometry of more complex or subtle scenes. In such cases, it may be preferable to largely forego image-based clustering and classification altogether and instead use spectral data directly in an adjacency-style analysis <span class="citation">(as per ‘method 1’ in <a href="references.html#ref-Endler2012">Endler 2012</a>)</span>. One such approach would have us take spectral measurements across a patch in an evenly-spaced grid</p>
<div class="sourceCode" id="cb258"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load up our image of a camouflaged lizard</span></span>
<span><span class="va">lizard</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/getimg.html">getimg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"testdata/images/vig/"</span>, package <span class="op">=</span> <span class="st">"pavo"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="cm"><code>#&gt; 1 files found; importing images.</code></pre>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Take a look at it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">lizard</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># And overlay a simple 'sampling grid' that might</span></span>
<span><span class="co"># guide us as to where we should collect our reflectance</span></span>
<span><span class="co"># measurements. Note that the grid here is likely too</span></span>
<span><span class="co"># coarse to capture the necessary detail, though the</span></span>
<span><span class="co"># sampling density is something to be closely considered on a case-by-case basis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">lizard</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">lizard</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">25</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">lizard</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">25</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="st">"red"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-115"></span>
<img src="colsci-book_files/figure-html/unnamed-chunk-115-1.png" alt="A cryptic lizard, along with a possible sampling grid for spectral measurement." width="75%"><p class="caption">
Figure 3.20: A cryptic lizard, along with a possible sampling grid for spectral measurement.
</p>
</div>
<p>For the sake of this example we’ll simulate 100 reflectance spectra, as though we had collected them following the above grid. We’ll do this by creating four very similar groups of of 25 spectra, which will also allow us to get a sense of how our clustering methods perform. Of course real spectra will be more variable, but the same principles apply.</p>
<div class="sourceCode" id="cb261"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">12352</span><span class="op">)</span> <span class="co"># For reprodicubility</span></span>
<span></span>
<span><span class="co"># Generate some fake spectra that were grid-sampled across our scene</span></span>
<span><span class="va">fakescene</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span></span>
<span>    <span class="va">cbind</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">300</span><span class="op">:</span><span class="fl">700</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">320</span>, <span class="fl">330</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span></span>
<span>    <span class="va">cbind</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">300</span><span class="op">:</span><span class="fl">700</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">440</span>, <span class="fl">450</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span></span>
<span>    <span class="va">cbind</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">300</span><span class="op">:</span><span class="fl">700</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">550</span>, <span class="fl">560</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span></span>
<span>    <span class="va">cbind</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">300</span><span class="op">:</span><span class="fl">700</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">650</span>, <span class="fl">660</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert them to rspce objects</span></span>
<span><span class="va">fakescene</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/as.rspec.html">as.rspec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>wl <span class="op">=</span> <span class="fl">300</span><span class="op">:</span><span class="fl">700</span>, <span class="va">fakescene</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now instead of calling <code>cluster()</code> on the image and arbitrarily selecting <code>kcols</code> (which would likely be quite inaccurate due to the complexity of the scene), we can visually model the spectra, calculate the colour-distances between them, and cluster the results into a data-image that can be fed directly into <code><a href="http://pavo.colrverse.com/reference/adjacent.html">adjacent()</a></code>. Below we’ll use a centroid-based ‘hartigan’ clustering method via the package <code>NbClust</code>, but there are numerous possible approaches that might be used, which should be closely considered with reference to the original methods’ publications.</p>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visually model our spectra in a tetrahedral model of the blue</span></span>
<span><span class="co"># tit, specifying relative = FALSE so that we can estimate</span></span>
<span><span class="co"># noise-calibrated distances.</span></span>
<span><span class="va">vis.fakescene</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/vismodel.html">vismodel</a></span><span class="op">(</span><span class="va">fakescene</span>,</span>
<span>  visual <span class="op">=</span> <span class="st">"bluetit"</span>,</span>
<span>  relative <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  scale <span class="op">=</span> <span class="fl">10000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate noise-weighted distances, before converting</span></span>
<span><span class="co"># them to xyz coordinates in noise-corrected colourspace.</span></span>
<span><span class="va">jnd.fakescene</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://pavo.colrverse.com/reference/jnd2xyz.html">jnd2xyz</a></span><span class="op">(</span><span class="fu"><a href="http://pavo.colrverse.com/reference/coldist.html">coldist</a></span><span class="op">(</span><span class="va">vis.fakescene</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a distance matrix, for clustering</span></span>
<span><span class="va">jnd.mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">jnd.fakescene</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"euclidean"</span>,</span>
<span>  diag <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Zero all distance &lt; 1 ('just noticeable distance',</span></span>
<span><span class="co"># in this model), which corresponds to a theoretical</span></span>
<span><span class="co"># threshold of discrimination in the receptor-noise limited</span></span>
<span><span class="co"># model.</span></span>
<span><span class="va">jnd.mat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">jnd.mat</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Load up a library and use k-means clustering to</span></span>
<span><span class="co"># estimate the number of discrete colours present in our sample.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sites.google.com/site/malikacharrad/research/nbclust-package">NbClust</a></span><span class="op">)</span></span>
<span><span class="va">clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/NbClust/man/NbClust.html">NbClust</a></span><span class="op">(</span><span class="va">jnd.fakescene</span>,</span>
<span>  diss <span class="op">=</span> <span class="va">jnd.mat</span>,</span>
<span>  distance <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"centroid"</span>,</span>
<span>  index <span class="op">=</span> <span class="st">"hartigan"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">clust</span><span class="op">$</span><span class="va">Best.nc</span></span></code></pre></div>
<pre><code>#&gt; Number_clusters     Value_Index 
#&gt;           4.000        1639.353</code></pre>
<p>This approach has identified four distinct colour patches, as simulated. To be able to feed this information directly in to <code><a href="http://pavo.colrverse.com/reference/adjacent.html">adjacent()</a></code> we need to arrange the now-classified spectral data into a xyz data-image matrix, in which <code>x</code> and <code>y</code> coordinates specify the location of the sample in our scene, and the z values at each location specify the colour-class, or group, into which each sample has been classified (an integer). Many clustering packages offers the data’s classification as output in some form, so we can simply rearrange it into our original 10 x 10 sampling matrix before passing it to <code><a href="http://pavo.colrverse.com/reference/adjacent.html">adjacent()</a></code>.</p>
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Rearrange the data into a colour-classified</span></span>
<span><span class="co"># image matrix, and take a look at it. Note that</span></span>
<span><span class="co"># is the same structure as the output of 'classify()'.</span></span>
<span><span class="va">mat.fakescene</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">clust</span><span class="op">$</span><span class="va">Best.partition</span><span class="op">)</span><span class="op">)</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">mat.fakescene</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
#&gt; [1,]    1    1    1    2    2    3    3    3    4     4
#&gt; [2,]    1    1    1    2    2    3    3    3    4     4
#&gt; [3,]    1    1    1    2    2    3    3    3    4     4
#&gt; [4,]    1    1    1    2    2    3    3    3    4     4
#&gt; [5,]    1    1    1    2    2    3    3    3    4     4
#&gt; [6,]    1    1    2    2    2    3    3    4    4     4</code></pre>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the adjacency analysis</span></span>
<span><span class="fu"><a href="http://pavo.colrverse.com/reference/adjacent.html">adjacent</a></span><span class="op">(</span><span class="va">mat.fakescene</span>, xscale <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;     k   N n_off  p_1  p_2  p_3  p_4     q_1_1      q_1_2     q_2_2
#&gt; img 4 180    32 0.25 0.25 0.25 0.25 0.2055556 0.06111111 0.2055556
#&gt;          q_2_3     q_3_3      q_3_4     q_4_4   t_1_2  t_2_3
#&gt; img 0.05555556 0.2055556 0.06111111 0.2055556 0.34375 0.3125
#&gt;       t_3_4     m   m_r   m_c  A Sc       St Jc        Jt  B Rt Rab
#&gt; img 0.34375 0.008 0.015 0.001 15  4 2.994152  1 0.4990253 NA NA  NA
#&gt;     m_dS s_dS cv_dS m_dL s_dL cv_dL m_hue s_hue var_hue m_sat s_sat
#&gt; img   NA   NA    NA   NA   NA    NA    NA    NA      NA    NA    NA
#&gt;     cv_sat m_lum s_lum cv_lum
#&gt; img     NA    NA    NA     NA</code></pre>
<p>The output reflects several aspects of our simulated dataset, which is reassuring. There are four colour classes (<code>k</code>= 4) or equal proportion (<code>p_x</code>), 180 transitions in total (<code>N</code>, 9 transitions per row/column x 10 rows/columns), and the colour diversity (<code>Sc</code>) equals <code>k</code>, and relative colour diversity (<code>Jc</code>) equals 1, since all colours occur in equal proportions.</p>

</div>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="importing-processing-and-visualising-data.html"><span class="header-section-number">2</span> Importing, Processing, and Visualising Data</a></div>
<div class="next"><a href="spectral-shape-descriptors.html"><span class="header-section-number">4</span> Spectral shape descriptors</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#analysing-data"><span class="header-section-number">3</span> Analysing Data</a></li>
<li>
<a class="nav-link" href="#analysing-spectral-data"><span class="header-section-number">3.1</span> Analysing Spectral Data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#spectral-dataset-description-1"><span class="header-section-number">3.1.1</span> Spectral Dataset Description</a></li>
<li><a class="nav-link" href="#overview-1"><span class="header-section-number">3.1.2</span> Overview</a></li>
<li><a class="nav-link" href="#spectral-shape-analysis"><span class="header-section-number">3.1.3</span> Spectral Shape Analysis</a></li>
<li><a class="nav-link" href="#visual-modelling"><span class="header-section-number">3.1.4</span> Visual Modelling</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#analysing-spatial-data"><span class="header-section-number">3.2</span> Analysing Spatial Data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#image-based-colour-classification"><span class="header-section-number">3.2.1</span> Image-based colour classification</a></li>
<li><a class="nav-link" href="#adjacency-and-boundary-strength-analyses-and-overall-pattern-contrasts"><span class="header-section-number">3.2.2</span> Adjacency and Boundary Strength Analyses, and Overall Pattern Contrasts</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/colrverse/colsci-book/blob/master/02-analysing.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/colrverse/colsci-book/edit/master/02-analysing.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The pavo handbook: studying biological colouration in R</strong>" was written by . It was last built on 2024-06-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
